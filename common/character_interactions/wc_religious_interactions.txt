##########################
# Purge of Heresy tenets #
# by ElMariuso (chad)    #
##########################

give_scarlet_mark_interaction = {
	category = interaction_category_hostile
	common_interaction = yes #suppress error
	icon = give_scarlet_mark

	desc = give_scarlet_mark_interaction_desc

	is_shown = {
		scope:actor = {
			trigger_if = {
				limit = { exists = faith.religious_head }
				this = faith.religious_head
			}
			trigger_else = {
				liege ?= { is_independent_ruler = yes }
				NOT = { this = liege }
				has_council_position = councillor_court_chaplain
			}
		}
		scope:actor.faith = {
			this = scope:recipient.faith
			has_doctrine = tenet_purge_of_heresy
			#has_doctrine = doctrine_spiritual_head
		}

		NOT = {
			scope:recipient = {
				has_trait = excommunicated
			}
		}

		NOT = { #Don't do this to yourself
			scope:recipient = scope:actor 
		}
	}

	is_valid_showing_failures_only = {
		scope:recipient = {
			age >= age_12_value
		}
		scope:actor = {
			piety >= medium_piety_value
		}
		scope:actor = {
			custom_description = {
				text = "hof_interaction_unreformed_faith"
				NOT = {
					faith = { has_doctrine_parameter = unreformed }
				}
			}
		}
		scope:recipient = { NOT = { has_strong_hook = scope:actor } }
		custom_tooltip = {
			text = cannot_take_overt_hostile_actions_against_diarch.tt
			NOT = { scope:recipient ?= scope:actor.diarch }
		}
	}

	auto_accept = yes
	force_notification = yes
	notification_text = wc_religious_interaction.1021
	
	on_accept = {
		scope:actor = {
			add_piety = minor_piety_loss
			hidden_effect = {
				send_interface_toast = {	
					title = give_scarlet_mark_interaction_desc.tt
					left_icon = scope:recipient
					scope:recipient = {
						show_as_tooltip = { add_trait = scarlet_mark }
					}
				}
			}
		}
		scarlet_mark_character = {
			REQUESTING_CHARACTER = scope:actor
			TARGET_CHARACTER = scope:recipient
		}

		scope:recipient = {
			hidden_effect = { #Nudge towards rivalry
				if = {
					limit = {
						NOR = {
							has_relation_rival = scope:actor
							has_relation_potential_rival = scope:actor
						}
					}
					set_relation_potential_rival = scope:actor
				}
			}
		}
	}
	
	# AI will do
	
	ai_potential = {
		is_adult = yes
		piety >= medium_piety_value
	}
	
	ai_target_quick_trigger = {
		adult = yes
	}

	ai_targets = {
		ai_recipients = scripted_relations
		ai_recipients = primary_war_enemies
	}
	
	ai_frequency = 4

	ai_will_do = {
		base = 50

		ai_value_modifier = {
			who = scope:actor
			ai_vengefulness = 0.5
		}
		
		modifier = {
			add = {
				add = 10
				multiply = scope:recipient.num_sinful_traits
			}
			scope:recipient.num_sinful_traits > 0
			desc = EXCOMMUNICATION_SINS
		}
	}
}