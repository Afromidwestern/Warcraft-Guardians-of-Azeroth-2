#############################################
# Enforce the Brotherhood of Northshire		#
# by ElMariuso								#
#############################################

enforce_the_brotherhood_decision = {
	picture = "gfx/interface/illustrations/decisions/fp1_decision_forge_jomsvikings.dds"
	major = yes

	ai_check_interval = 120

	desc = enforce_the_brotherhood_decision_desc
	selection_tooltip = enforce_the_brotherhood_decision_tooltip

	is_shown = {
		is_landed = yes
		has_title = title:k_stormwind
		
		# Must follow the Church
		faith = { wc_valid_light_faith_for_northshire_trigger = yes }
		# Should be at war against a crisis
		any_war_enemy = { is_crisis_trigger = yes }
		
		# Brotherhood cannot have existed already.
		brotherhood_have_not_existed_trigger = yes
	}

	is_valid = {
		# Must be independent.
		is_independent_ruler = yes
		
		# The abbot should exist and not the ruler
		any_vassal = {
			NOT = { has_title = title:k_stormwind }
			has_title = title:c_northshire
			government_has_flag = government_is_theocracy
		}
		
		# Repeat faith requirements
		custom_tooltip = {
			faith = { wc_valid_light_faith_for_northshire_trigger = yes }
			text = wc_valid_light_faith_for_northshire_trigger_tt
		}
		# Repeat crisis requirements
		custom_tooltip = {
			any_war_enemy = { is_crisis_trigger = yes }
			text = wc_at_war_against_crisis_trigger_tt
		}
	}

	is_valid_showing_failures_only = {
		is_adult = yes
		is_alive = yes
		is_imprisoned = no
		has_contagious_deadly_disease_trigger = no
		is_incapable = no
		is_travelling = no
		custom_description = {
			text = ALREADY_IN_ACTIVITY
			NOR = {
				exists = involved_activity
				has_variable = homage_liege_scope
				has_character_flag = meditation_character_flag
				has_character_flag = petition_liege_character_flag
				has_character_flag = holding_court_character_flag
				is_being_visited_on_tour_strict = yes
			}
		}
		custom_description = {
			text = ALREADY_PLANNING_ACTIVITY
			NOT = { has_character_flag = planning_an_activity }
		}
		# Variable set within the adventure inspiration events
		NOT = { has_variable = gone_adventuring }
	}

	effect = {
		save_scope_as = founder
		title:c_northshire.holder = { save_scope_as = abbot }
		random_war_enemy = {
			limit = { is_crisis_trigger = yes }
			save_scope_as = invader
		}
		# Show the results.
		show_as_tooltip = { enforce_the_brotherhood_decision_tooltip_effect = yes }
		# Send out events.
		trigger_event = { id = wc_holy_order_decision.0001 }
		# Notification of other players is handled in the immediate block of scope:founder's event.
		# Flag to stop this repeating is filed in the scripted effect, since we might forge them via event instead.
	}

	cost = {
		piety = 300
		gold = 200
	}

	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 100
	}
}