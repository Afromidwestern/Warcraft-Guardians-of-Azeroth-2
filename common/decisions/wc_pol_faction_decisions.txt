# Warcraft
create_union_universal = {
	ai_check_interval = 8
	picture = "gfx/interface/illustrations/decisions/union_decision.dds"
	major = yes

	is_shown = {
		is_landed = yes
		highest_held_title_tier >= tier_duchy
		is_in_any_this_union_trigger = no
		can_lead_union_decision_flag_trigger = { landless = no }
		# Before 603, factions can't be outside the EK
		this_union_region_trigger = yes
	}

	is_valid = {
		has_this_union_cooldown_trigger = no
		realm_size >= this_union_leader_realm_size

		OR = {
			highest_held_title_tier = tier_empire
			diplomacy >= 10
		}
	}

	is_valid_showing_failures_only = {
		custom_tooltip = {
			text = create_union_universal_no_union_valid_tt
			OR = {
				create_alliance_union_triggers = yes
				create_horde_union_triggers = yes
				create_custom_union_triggers = yes
			}
		}
		trigger_if = { # Alliance union
			limit = { scope:alliance_union = yes }
			custom_tooltip = {
				text = create_union_universal_alliance_trigger_tt
				create_alliance_union_triggers = yes
			}
		}
		trigger_if = { # Horde union
			limit = { scope:horde_union = yes }
			custom_tooltip = {
				text = create_union_universal_horde_trigger_tt
				create_horde_union_triggers = yes
			}
		}
		trigger_if = { # Custom union
			limit = { scope:custom_union = yes }
			custom_tooltip = {
				text = create_union_universal_custom_trigger_tt
				create_custom_union_triggers = yes
			}
		}
	}

	widget = {
		gui = "decision_view_widget_universal_union"
		controller = decision_option_list_controller
		
		decision_has_second_step = yes
		decision_custom_widget_container = "custom_widgets_container_step_two"
		decision_to_second_step_button = "choose_a_union_gui_button"

		item = {
			value = alliance_union
			is_valid = {
				create_alliance_union_triggers = yes
			}
			current_description = create_union_universal_alliance_desc
			localization = {
				desc = ALLIANCE
			}
			icon = "gfx/interface/icons/decisions/alliance_union.dds"

			ai_chance = {
				value = 100
			}
		}
		item = {
			value = horde_union
			is_valid = {
				create_horde_union_triggers = yes
			}
			current_description = create_union_universal_horde_desc
			localization = {
				desc = HORDE
			}
			icon = "gfx/interface/icons/decisions/horde_union.dds"

			ai_chance = {
				value = 100
			}
		}
		item = {
			value = custom_union

			is_valid = {
				create_custom_union_triggers = yes
			}
			current_description = create_union_universal_custom_desc
			localization = {
				desc = UNION
			}
			icon = "gfx/interface/icons/decisions/custom_union.dds"

			ai_chance = {
				value = 100
			}
		}
	}

	effect = {
		save_scope_as = faction_leader
		
		set_this_union_cooldown_effect = { years_number = 2 }
		
		stress_impact = {
			shy = medium_stress_gain
		}
		
		if = {
			limit = { scope:alliance_union = yes }
			become_leader_of_union_flag_effect = {
				faction = alliance
				give_modifiers = yes
			}
			every_player = {
				trigger_event = WCPLF.100
			}
		}
		else_if = {
			limit = { scope:horde_union = yes }
			become_leader_of_union_flag_effect = {
				faction = horde
				give_modifiers = yes
			}
			every_player = {
				trigger_event = WCPLF.100
			}
		}
		else_if = {
			limit = { scope:custom_union = yes }
			save_scope_value_as = { name = creating_custom value = flag:yes }
			show_as_tooltip = {
				become_leader_of_union_flag_effect = {
					faction = custom
					give_modifiers = yes
				}
			}
			
			trigger_event = WCPLF.330
		}
	}
	
	ai_potential = {
		always = yes
	}
	
	ai_will_do = {
		base = 100
	}
}

join_universal_union = {
	ai_check_interval = 24
	picture = "gfx/interface/illustrations/decisions/union_decision.dds"
	major = yes
	
	is_shown = {
		has_global_variable_list = all_unions
		NOT = { has_variable = this_union }
		common_union_trigger = { landless = no }
		# Before 603, factions can't be outside the EK
		this_union_region_trigger = yes
	}

	is_valid = {
		has_this_union_cooldown_trigger = no
	}

	is_valid_showing_failures_only = {
		custom_tooltip = {
			text = create_union_universal_no_union_valid_tt
			OR = {
				can_join_union_trigger = { faction = alliance }
				can_join_union_trigger = { faction = horde }
				can_join_union_trigger = { faction = custom }
			}
		}
		trigger_if = { # Alliance union
			limit = { scope:alliance_union = yes }
			custom_tooltip = {
				text = create_union_universal_alliance_trigger_tt
				can_join_union_trigger = { faction = alliance }
			}
		}
		trigger_if = { # Horde union
			limit = { scope:horde_union = yes }
			custom_tooltip = {
				text = create_union_universal_horde_trigger_tt
				can_join_union_trigger = { faction = horde }
			}
		}
		trigger_if = { # Custom union
			limit = { scope:custom_union = yes }
			custom_tooltip = {
				text = create_union_universal_custom_trigger_tt
				can_join_union_trigger = { faction = custom }
			}
		}
		trigger_if = {
			limit = { exists = title:e_horde.holder scope:horde_union = no }
			NOT = { has_title = title:e_horde }
		}
	}

	widget = {
		gui = "decision_view_widget_universal_union"
		controller = decision_option_list_controller
		
		decision_has_second_step = yes
		decision_custom_widget_container = "custom_widgets_container_step_two"
		decision_to_second_step_button = "choose_a_union_gui_button"

		item = {
			value = alliance_union

			is_shown = {
				any_in_global_list = {
					variable = all_unions
					var:this_union = flag:alliance
				}
			}
			is_valid = {
				can_join_union_trigger = { faction = alliance }
			}
			current_description = create_union_universal_alliance_desc
			localization = {
				desc = ALLIANCE
			}
			icon = "gfx/interface/icons/decisions/alliance_union.dds"

			ai_chance = {
				value = 1
				multiply = join_alliance_decision
			}
		}
		item = {
			value = horde_union

			is_shown = {
				any_in_global_list = {
					variable = all_unions
					var:this_union = flag:horde
				}
			}
			is_valid = {
				can_join_union_trigger = { faction = horde }
			}
			current_description = create_union_universal_horde_desc
			localization = {
				desc = HORDE
			}
			icon = "gfx/interface/icons/decisions/horde_union.dds"

			ai_chance = {
				value = 1
				multiply = join_horde_decision
			}
		}
		item = {
			value = custom_union

			is_shown = {
				any_in_global_list = {
					variable = all_unions
					var:this_union = flag:custom
				}
			}
			is_valid = {
				can_join_union_trigger = { faction = custom }
			}
			current_description = create_union_universal_custom_desc
			localization = {
				desc = union_custom_name
			}
			icon = "gfx/interface/icons/decisions/custom_union.dds"

			ai_chance = {
				value = 1
				multiply = join_custom_union_decision
			}
		}
	}

	effect = {
		set_this_union_cooldown_effect = { years_number = 1 }
		
		if = {
			limit = { scope:alliance_union = yes }
			request_this_union_joining_effect = { faction = alliance }
		}
		else_if = {
			limit = { scope:horde_union = yes }
			request_this_union_joining_effect = { faction = horde }
		}
		else_if = {
			limit = { scope:custom_union = yes }
			request_this_union_joining_effect = { faction = custom }
		}
	}
	
	ai_will_do = {
		base = 1
		join_common_modifiers = yes
	}
}

leave_universal_union = {
	ai_check_interval = 24
	picture = "gfx/interface/illustrations/decisions/union_decision.dds"
	major = yes
	
	is_shown = {
		is_ruler = yes
		has_variable = this_union
	}

	is_valid = {
		has_this_union_cooldown_trigger = no
		can_leave_union_trigger = yes
	}

	effect = {
		leave_or_break_this_union_effect = yes
	}
	
	ai_will_do = {
		base = 0
		modifier = {
			add = 50
			any_in_global_list = {
				variable = all_unions
				var:this_union = root.var:this_union
				story_owner = { save_temporary_scope_as = union_leader }
			}
			NOT = { ai_has_joining_union_opinion_trigger = { target = scope:union_leader } }
		}
		modifier = {
			factor = 0
			leads_any_this_union_trigger = yes
		}
	}
}