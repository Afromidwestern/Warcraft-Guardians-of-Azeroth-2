#### Yearly check to see if Exodar event chain can begin
yearly_global_pulse = {
	on_actions = { exodar_check }
}
exodar_check = {
	effect = {
		if = {
			limit = { NOT = { exists = global_var:exodar_event_chain_started } }
			random = {
				chance = 0 # No chance to start for all bookmarks
				modifier = {
					add = 2 # 2% chance per year
					current_date >= 606.1.1
				}
				modifier = {
					add = 8 # 10% chance per year
					current_date >= 610.1.1
				}
				modifier = {
					add = 15 # 25% chance per year
					current_date >= 620.1.1
				}
				set_global_variable = {
					name = exodar_event_chain_started
					value = yes
				}
				trigger_event = { on_action = exodar_setup months = { 2 4 } }
			}
		}
	}
}

#### Exodar Setup, and Early Warning to Azuremyst Isle Players
exodar_setup = {
	effect = {
		every_player = {
			limit = { capital_province ?= { geographical_region = world_kalimdor_north_veiled_isles } }
			trigger_event = exodar.1003
		}
		trigger_event = { on_action = exodar_crash years = { 4 7 } }
	}
}

#### Trigger the crash of the Exodar
exodar_crash = {
	effect = {
		create_characters_exodar_effect = yes
		update_opinions_exodar_effect = yes
		setup_titles_azuremyst_exodar_effect = yes
		setup_base_army_exodar_effect = yes
		
		#Notify Players
		every_player = {
			if = {
				limit = {
					OR = {
						is_within_diplo_range = { CHARACTER = scope:velen }
						is_within_diplo_range = { CHARACTER = scope:maraad }
						is_within_diplo_range = { CHARACTER = scope:proenitus }
						is_within_diplo_range = { CHARACTER = scope:admetius }
						is_within_diplo_range = { CHARACTER = scope:ishanah }
					}
				}
				trigger_event = exodar.1001
			}
			else = { trigger_event = exodar.1002 }
		}
	}
}