### MANA

wc_sorcerer_trait_1_mana_value = 10
wc_sorcerer_trait_noninheritable_mana_value = 15
wc_sorcerer_trait_2_mana_value = 20
wc_sorcerer_trait_3_mana_value = 30

wc_base_mana_value = {
	desc = wc_mana_base_value_desc
	format = "WC_MAX_MANA_VALUE_FORMAT"

	value = 10
}

wc_mana_per_magic_perk_base_value = 2 # Also used in localization
wc_mana_per_magic_perk_magiclevel2_value = 3 # Also used in localization
wc_mana_per_magic_perk_magiclevel3_value = 4 # Also used in localization
wc_mana_per_magic_perk_magiclevel4_value = 5 # Also used in localization

wc_mana_per_light_magic_perk_value = {
	if = {
		limit = { has_trait = user_of_light_magic_2 }

		value = wc_mana_per_magic_perk_magiclevel2_value
	}
	else_if = {
		limit = { has_trait = user_of_light_magic_3 }

		value = wc_mana_per_magic_perk_magiclevel3_value
	}
	else_if = {
		limit = {
			OR = {
				has_trait = user_of_light_magic_4
				has_trait = user_of_light_magic_5
			}
		}

		value = wc_mana_per_magic_perk_magiclevel4_value
	}
	else = { value = wc_mana_per_magic_perk_base_value }
}
wc_mana_per_shadow_magic_perk_value = {
	if = {
		limit = { has_trait = user_of_shadow_magic_2 }

		value = wc_mana_per_magic_perk_magiclevel2_value
	}
	else_if = {
		limit = { has_trait = user_of_shadow_magic_3 }

		value = wc_mana_per_magic_perk_magiclevel3_value
	}
	else_if = {
		limit = {
			OR = {
				has_trait = user_of_shadow_magic_4
				has_trait = user_of_shadow_magic_5
			}
		}

		value = wc_mana_per_magic_perk_magiclevel4_value
	}
	else = { value = wc_mana_per_magic_perk_base_value }
}
wc_mana_per_disorder_magic_perk_value = {
	if = {
		limit = { has_trait = user_of_disorder_magic_2 }

		value = wc_mana_per_magic_perk_magiclevel2_value
	}
	else_if = {
		limit = { has_trait = user_of_disorder_magic_3 }

		value = wc_mana_per_magic_perk_magiclevel3_value
	}
	else_if = {
		limit = {
			OR = {
				has_trait = user_of_disorder_magic_4
				has_trait = user_of_disorder_magic_5
			}
		}

		value = wc_mana_per_magic_perk_magiclevel4_value
	}
	else = { value = wc_mana_per_magic_perk_base_value }
}
wc_mana_per_order_magic_perk_value = {
	if = {
		limit = { has_trait = user_of_order_magic_2 }

		value = wc_mana_per_magic_perk_magiclevel2_value
	}
	else_if = {
		limit = { has_trait = user_of_order_magic_3 }

		value = wc_mana_per_magic_perk_magiclevel3_value
	}
	else_if = {
		limit = {
			OR = {
				has_trait = user_of_order_magic_4
				has_trait = user_of_order_magic_5
			}
		}

		value = wc_mana_per_magic_perk_magiclevel4_value
	}
	else = { value = wc_mana_per_magic_perk_base_value }
}
wc_mana_per_life_magic_perk_value = {
	if = {
		limit = { has_trait = user_of_life_magic_2 }

		value = wc_mana_per_magic_perk_magiclevel2_value
	}
	else_if = {
		limit = { has_trait = user_of_life_magic_3 }

		value = wc_mana_per_magic_perk_magiclevel3_value
	}
	else_if = {
		limit = {
			OR = {
				has_trait = user_of_life_magic_4
				has_trait = user_of_life_magic_5
			}
		}

		value = wc_mana_per_magic_perk_magiclevel4_value
	}
	else = { value = wc_mana_per_magic_perk_base_value }
}
wc_mana_per_death_magic_perk_value = {
	if = {
		limit = { has_trait = user_of_death_magic_2 }

		value = wc_mana_per_magic_perk_magiclevel2_value
	}
	else_if = {
		limit = { has_trait = user_of_death_magic_3 }

		value = wc_mana_per_magic_perk_magiclevel3_value
	}
	else_if = {
		limit = {
			OR = {
				has_trait = user_of_death_magic_4
				has_trait = user_of_death_magic_5
			}
		}

		value = wc_mana_per_magic_perk_magiclevel4_value
	}
	else = { value = wc_mana_per_magic_perk_base_value }
}
wc_mana_per_elemental_fire_magic_perk_value = {
	if = {
		limit = { has_trait = user_of_elemental_fire_magic_2 }

		value = wc_mana_per_magic_perk_magiclevel2_value
	}
	else_if = {
		limit = { has_trait = user_of_elemental_fire_magic_3 }

		value = wc_mana_per_magic_perk_magiclevel3_value
	}
	else_if = {
		limit = {
			OR = {
				has_trait = user_of_elemental_fire_magic_4
				has_trait = user_of_elemental_fire_magic_5
			}
		}

		value = wc_mana_per_magic_perk_magiclevel4_value
	}
	else = { value = wc_mana_per_magic_perk_base_value }
}
wc_mana_per_elemental_water_magic_perk_value = {
	if = {
		limit = { has_trait = user_of_elemental_water_magic_2 }

		value = wc_mana_per_magic_perk_magiclevel2_value
	}
	else_if = {
		limit = { has_trait = user_of_elemental_water_magic_3 }

		value = wc_mana_per_magic_perk_magiclevel3_value
	}
	else_if = {
		limit = {
			OR = {
				has_trait = user_of_elemental_water_magic_4
				has_trait = user_of_elemental_water_magic_5
			}
		}

		value = wc_mana_per_magic_perk_magiclevel4_value
	}
	else = { value = wc_mana_per_magic_perk_base_value }
}
wc_mana_per_elemental_air_magic_perk_value = {
	if = {
		limit = { has_trait = user_of_elemental_air_magic_2 }

		value = wc_mana_per_magic_perk_magiclevel2_value
	}
	else_if = {
		limit = { has_trait = user_of_elemental_air_magic_3 }

		value = wc_mana_per_magic_perk_magiclevel3_value
	}
	else_if = {
		limit = {
			OR = {
				has_trait = user_of_elemental_air_magic_4
				has_trait = user_of_elemental_air_magic_5
			}
		}

		value = wc_mana_per_magic_perk_magiclevel4_value
	}
	else = { value = wc_mana_per_magic_perk_base_value }
}
wc_mana_per_elemental_earth_magic_perk_value = {
	if = {
		limit = { has_trait = user_of_elemental_earth_magic_2 }

		value = wc_mana_per_magic_perk_magiclevel2_value
	}
	else_if = {
		limit = { has_trait = user_of_elemental_earth_magic_3 }

		value = wc_mana_per_magic_perk_magiclevel3_value
	}
	else_if = {
		limit = {
			OR = {
				has_trait = user_of_elemental_earth_magic_4
				has_trait = user_of_elemental_earth_magic_5
			}
		}

		value = wc_mana_per_magic_perk_magiclevel4_value
	}
	else = { value = wc_mana_per_magic_perk_base_value }
}

wc_max_mana_value = {
	if = { # Light
		limit = { has_trait = wc_lifestyle_light_magic }

		min = wc_base_mana_value

		add = {
			desc = wc_mana_from_light_perks_value_desc
			format = "WC_MAX_MANA_VALUE_FORMAT"

			value = light_magic_lifestyle_perks
			add = light_magic_lifestyle_perk_points
			multiply = wc_mana_per_light_magic_perk_value
		}
	}
	if = { # Shadow
		limit = { has_trait = wc_lifestyle_shadow_magic }

		min = wc_base_mana_value

		add = {
			desc = wc_mana_from_shadow_perks_value_desc
			format = "WC_MAX_MANA_VALUE_FORMAT"

			value = shadow_magic_lifestyle_perks
			add = shadow_magic_lifestyle_perk_points
			multiply = wc_mana_per_shadow_magic_perk_value
		}
	}
	if = { # Disorder
		limit = { has_trait = wc_lifestyle_disorder_magic }

		min = wc_base_mana_value

		add = {
			desc = wc_mana_from_disorder_perks_value_desc
			format = "WC_MAX_MANA_VALUE_FORMAT"

			value = disorder_magic_lifestyle_perks
			add = disorder_magic_lifestyle_perk_points
			multiply = wc_mana_per_disorder_magic_perk_value
		}
	}
	if = { # Order
		limit = { has_trait = wc_lifestyle_order_magic }

		min = wc_base_mana_value

		add = {
			desc = wc_mana_from_order_perks_value_desc
			format = "WC_MAX_MANA_VALUE_FORMAT"

			value = order_magic_lifestyle_perks
			add = order_magic_lifestyle_perk_points
			multiply = wc_mana_per_order_magic_perk_value
		}
	}
	if = { # Life
		limit = { has_trait = wc_lifestyle_life_magic }

		min = wc_base_mana_value

		add = {
			desc = wc_mana_from_life_perks_value_desc
			format = "WC_MAX_MANA_VALUE_FORMAT"

			value = life_magic_lifestyle_perks
			add = life_magic_lifestyle_perk_points
			multiply = wc_mana_per_life_magic_perk_value
		}
	}
	if = { # Death
		limit = { has_trait = wc_lifestyle_death_magic }

		min = wc_base_mana_value

		add = {
			desc = wc_mana_from_death_perks_value_desc
			format = "WC_MAX_MANA_VALUE_FORMAT"

			value = death_magic_lifestyle_perks
			add = death_magic_lifestyle_perk_points
			multiply = wc_mana_per_death_magic_perk_value
		}
	}
	# Elemental
	if = { # Fire
		limit = { has_trait_with_flag = wc_lifestyle_elemental_fire_magic_flag }

		min = wc_base_mana_value

		add = {
			desc = wc_mana_from_elemental_fire_perks_value_desc
			format = "WC_MAX_MANA_VALUE_FORMAT"

			value = elemental_fire_magic_lifestyle_perks
			add = elemental_fire_magic_lifestyle_perk_points
			multiply = wc_mana_per_elemental_fire_magic_perk_value
		}
	}
	if = { # Water
		limit = { has_trait_with_flag = wc_lifestyle_elemental_water_magic_flag }

		min = wc_base_mana_value

		add = {
			desc = wc_mana_from_elemental_water_perks_value_desc
			format = "WC_MAX_MANA_VALUE_FORMAT"

			value = elemental_water_magic_lifestyle_perks
			add = elemental_water_magic_lifestyle_perk_points
			multiply = wc_mana_per_elemental_water_magic_perk_value
		}
	}
	if = { # Air
		limit = { has_trait_with_flag = wc_lifestyle_elemental_air_magic_flag }

		min = wc_base_mana_value

		add = {
			desc = wc_mana_from_elemental_air_perks_value_desc
			format = "WC_MAX_MANA_VALUE_FORMAT"

			value = elemental_air_magic_lifestyle_perks
			add = elemental_air_magic_lifestyle_perk_points
			multiply = wc_mana_per_elemental_air_magic_perk_value
		}
	}
	if = { # Earth
		limit = { has_trait_with_flag = wc_lifestyle_elemental_earth_magic_flag }

		min = wc_base_mana_value

		add = {
			desc = wc_mana_from_elemental_earth_perks_value_desc
			format = "WC_MAX_MANA_VALUE_FORMAT"

			value = elemental_earth_magic_lifestyle_perks
			add = elemental_earth_magic_lifestyle_perk_points
			multiply = wc_mana_per_elemental_earth_magic_perk_value
		}
	}

	if = {
		limit = { has_trait = magic_good_1 }

		min = wc_base_mana_value

		add = {
			desc = wc_mana_from_magic_good_1_trait_value_desc
			format = "WC_MAX_MANA_VALUE_FORMAT"

			value = wc_sorcerer_trait_1_mana_value
		}
	}
	else_if = {
		limit = { has_trait = magic_good_2 }

		min = wc_base_mana_value

		add = {
			desc = wc_mana_from_magic_good_2_trait_value_desc
			format = "WC_MAX_MANA_VALUE_FORMAT"

			value = wc_sorcerer_trait_2_mana_value
		}
	}
	else_if = {
		limit = { has_trait = magic_good_3 }

		min = wc_base_mana_value

		add = {
			desc = wc_mana_from_magic_good_3_trait_value_desc
			format = "WC_MAX_MANA_VALUE_FORMAT"

			value = wc_sorcerer_trait_3_mana_value
		}
	}
	else_if = {
		limit = { has_trait = magic_bad_1 }
		subtract = {
			desc = wc_mana_from_magic_bad_1_trait_value_desc
			format = "WC_MAX_MANA_VALUE_FORMAT"

			value = wc_sorcerer_trait_1_mana_value
		}
	}
	else_if = {
		limit = { has_trait = magic_bad_2 }
		subtract = {
			desc = wc_mana_from_magic_bad_2_trait_value_desc
			format = "WC_MAX_MANA_VALUE_FORMAT"

			value = wc_sorcerer_trait_2_mana_value
		}
	}
	else_if = {
		limit = { has_trait = magic_bad_3 }
		subtract = {
			desc = wc_mana_from_magic_bad_3_trait_value_desc
			format = "WC_MAX_MANA_VALUE_FORMAT"

			value = wc_sorcerer_trait_3_mana_value
		}
	}

	if = {
		limit = { has_trait = magic_good_noninheritable }
		add = {
			desc = wc_mana_from_magic_good_noninheritable_value_desc
			format = "WC_MAX_MANA_VALUE_FORMAT"

			value = wc_sorcerer_trait_noninheritable_mana_value
		}
	}
	else_if = {
		limit = { has_trait = magic_bad_noninheritable }
		subtract = {
			desc = wc_mana_from_magic_bad_noninheritable_value_desc
			format = "WC_MAX_MANA_VALUE_FORMAT"

			value = wc_sorcerer_trait_noninheritable_mana_value
		}
	}

	min = 0
	ceiling = yes
}

wc_magic_good_trait_1_mana_replenishment_value = 0.01
wc_magic_good_trait_noninheritable_mana_replenishment_value = 0.02
wc_magic_good_trait_2_mana_replenishment_value = 0.03
wc_magic_good_trait_3_mana_replenishment_value = 0.05

wc_magic_bad_trait_1_mana_regeneration_value = -0.05
wc_magic_bad_trait_noninheritable_mana_regeneration_value = -0.1
wc_magic_bad_trait_2_mana_regeneration_value = -0.15
wc_magic_bad_trait_3_mana_regeneration_value = -0.25

wc_mana_replenishment_base_value = 0.01 # Used in localization

wc_mana_replenishment_value = { # Used in localization
	value = wc_mana_replenishment_base_value

	if = {
		limit = { has_trait = magic_good_1 }
		add = wc_magic_good_trait_1_mana_replenishment_value
	}
	else_if = {
		limit = { has_trait = magic_good_2 }
		add = wc_magic_good_trait_2_mana_replenishment_value
	}
	else_if = {
		limit = { has_trait = magic_good_3 }
		add = wc_magic_good_trait_3_mana_replenishment_value
	}

	if = {
		limit = { has_trait = magic_good_noninheritable }
		add = wc_magic_good_trait_noninheritable_mana_replenishment_value
	}
}

wc_mana_regeneration_value = {
	value = {
		desc = wc_mana_regeneration_from_max_value_desc
		format = "WC_MANA_REPLENISHMENT_VALUE_FORMAT"

		add = wc_max_mana_value

		multiply = wc_mana_replenishment_value
	}

	multiply = { # Mana Regeneration
		value = 1

		if = {
			limit = { has_trait = magic_bad_1 }

			add = {
				desc = wc_mana_regeneration_from_magic_bad_1_trait_value_desc
				format = "WC_MANA_REGENERATION_VALUE_PERCENTAGE_FORMAT"

				value = wc_magic_bad_trait_1_mana_regeneration_value
			}
		}
		else_if = {
			limit = { has_trait = magic_bad_2 }

			add = {
				desc = wc_mana_regeneration_from_magic_bad_2_trait_value_desc
				format = "WC_MANA_REGENERATION_VALUE_PERCENTAGE_FORMAT"

				value = wc_magic_bad_trait_2_mana_regeneration_value
			}
		}
		else_if = {
			limit = { has_trait = magic_bad_3 }

			add = {
				desc = wc_mana_regeneration_from_magic_bad_3_trait_value_desc
				format = "WC_MANA_REGENERATION_VALUE_PERCENTAGE_FORMAT"

				value = wc_magic_bad_trait_3_mana_regeneration_value
			}
		}
		if = {
			limit = { has_trait = magic_bad_noninheritable }

			add = {
				desc = wc_mana_regeneration_from_magic_bad_noninheritable_trait_value_desc
				format = "WC_MANA_REGENERATION_VALUE_PERCENTAGE_FORMAT"

				value = wc_magic_bad_trait_noninheritable_mana_regeneration_value
			}
		}
	}

	#every_in_list = {
	#	variable = wc_order_arcane_intellect_you_channel_on_variable_list
	#	subtract = wc_magic_spell_order_arcane_intellect_cost_mana_monthly_value
	#}

}

wc_sorcerer_trait_1_current_mana_to_prowess_value = 0.01
wc_sorcerer_trait_noninheritable_current_mana_to_prowess_value = 0.02
wc_sorcerer_trait_2_current_mana_to_prowess_value = 0.03
wc_sorcerer_trait_3_current_mana_to_prowess_value = 0.05

wc_current_mana_to_prowess_base_percent = 0.01 # Also used in localization

wc_current_mana_to_prowess_percent = {
	value = wc_current_mana_to_prowess_base_percent

	if = {
		limit = { has_trait = magic_good_1 }
		add = wc_sorcerer_trait_1_current_mana_to_prowess_value
	}
	else_if = {
		limit = { has_trait = magic_good_2 }
		add = wc_sorcerer_trait_2_current_mana_to_prowess_value
	}
	else_if = {
		limit = { has_trait = magic_good_3 }
		add = wc_sorcerer_trait_3_current_mana_to_prowess_value
	}
	else_if = {
		limit = { has_trait = magic_bad_1 }
		subtract = wc_sorcerer_trait_1_current_mana_to_prowess_value
	}
	else_if = {
		limit = { has_trait = magic_bad_2 }
		subtract = wc_sorcerer_trait_2_current_mana_to_prowess_value
	}
	else_if = {
		limit = { has_trait = magic_bad_3 }
		subtract = wc_sorcerer_trait_3_current_mana_to_prowess_value
	}

	if = {
		limit = { has_trait = magic_good_noninheritable }
		add = wc_sorcerer_trait_noninheritable_current_mana_to_prowess_value
	}
	else_if = {
		limit = { has_trait = magic_bad_noninheritable }
		subtract = wc_sorcerer_trait_noninheritable_current_mana_to_prowess_value
	}

	min = 0
}

wc_current_mana_to_prowess_value = {
	if = {
		limit = { has_variable = wc_current_mana_variable }
		add = var:wc_current_mana_variable
	}

	multiply = wc_current_mana_to_prowess_percent

	floor = yes
}

wc_current_mana_percent_value = { # Used in localization and progressbars
	if = {
		limit = { has_variable = wc_current_mana_variable }
		add = var:wc_current_mana_variable
	}
	divide = wc_max_mana_value

	min = 0
}

# Magic Resistance
wc_magic_resistance_base_value = 12 #12% of damage from this class is blocked
wc_magic_resistance_racial_value = 5
wc_magic_resistance_religion_criminal_value = -4
wc_magic_resistance_religion_shunned_value = -2
wc_magic_resistance_religion_accepted_value = 2
wc_magic_resistance_religion_idolised_value = 5
wc_magic_resistance_level2_value = 2
wc_magic_resistance_level3_value = 4
wc_magic_resistance_level4_value = 6

# DYNAMIC 
# $MAGIC$ = elemental_fire, light, order, etc.
wc_magic_resistance_value = {
	value = wc_magic_resistance_base_value
	if = { # Can be added or removed dynamically
		limit = { has_variable = wc_$MAGIC$_magic_resistance }
		add = var:wc_$MAGIC$_magic_resistance
	}
# From User traits
	if = { 
		limit = { has_trait = user_of_$MAGIC$_magic_2 }

		add = wc_magic_resistance_level2_value
	}
	else_if = {
		limit = { has_trait = user_of_$MAGIC$_magic_3 }

		add = wc_magic_resistance_level3_value
	}
	else_if = {
		limit = { has_trait = user_of_$MAGIC$_magic_4 }

		add = wc_magic_resistance_level4_value
	}
# By Faith
	if = {
		limit = {
			faith = { has_doctrine = doctrine_$MAGIC$_magic_approved }
		}
		add = wc_magic_resistance_religion_idolised_value
	}
	else_if = {
		limit = {
			faith = { has_doctrine = doctrine_$MAGIC$_magic_accepted }
		}
		add = wc_magic_resistance_religion_accepted_value
	}
	else_if = {
		limit = {
			faith = { has_doctrine = doctrine_$MAGIC$_magic_ignored }
		}
		add = wc_magic_resistance_religion_shunned_value
	}
	else_if = {
		limit = {
			faith = { has_doctrine = doctrine_$MAGIC$_magic_crime }
		}
		add = wc_magic_resistance_religion_criminal_value
	}
# By Race
	if = {
		limit = {
			has_trait_with_flag = racial_$MAGIC$_resistance
		}
		add = wc_magic_resistance_racial_value
	}
}