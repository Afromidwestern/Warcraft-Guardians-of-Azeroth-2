make_an_heir_agp = {
	create_character = {
		employer = root
		template = agp_heir_character
		save_scope_as = newchar
	}
	scope:newchar = { house = { save_scope_as = house_of_newchar } }

	#даем дом левому персу, чтобы дом не удалился из базы данных
	create_character = {
		employer = root
		age = { 62 98 }
		gender = male
		random_traits = yes
		save_scope_as = char
		dynasty = generate
	}
	scope:char = { set_house = scope:house_of_newchar }

	#меняем дом нашему наследнику, чтобы во вкладке происхождение отображалось все норм
	scope:newchar = {
		set_house = root.house
		add_prestige = 500
		add_piety = 300
	}

	#сохраняем наш тип правительства чтобы у наследника все было норм
	if = {
		limit = {
			has_government = republic_government
		}
		scope:newchar = { add_character_flag = { flag = temp_rep_gov days = 3 } }
	}
	else_if = {
		limit = {
			has_government = theocracy_government
		}
		scope:newchar = { add_character_flag = { flag = temp_theoc_gov days = 3 } }
	}
	else_if = {
		limit = {
			has_government = mercenary_government
		}
		scope:newchar = { add_character_flag = { flag = temp_merc_gov days = 3 } }
	}
	else_if = {
		limit = {
			has_government = holy_order_government
		}
		scope:newchar = { add_character_flag = { flag = temp_hol_ord_gov days = 3 } }
	}

	#сохраняем тип наследования чтобы у наследника все было норм
	if = {
		limit = {
			has_realm_law = city_succession_law
		}
		scope:newchar = { add_character_flag = { flag = temp_law_city days = 3 } }
		
	}
	else_if = {
		limit = {
			has_realm_law = bishop_theocratic_succession_law
		}
		scope:newchar = { add_character_flag = { flag = temp_law_bish days = 3 } }
	}
	else_if = {
		limit = {
			has_realm_law = mercenary_company_succession_law
		}
		scope:newchar = { add_character_flag = { flag = temp_law_merc days = 3 } }
	}
	else_if = {
		limit = {
			has_realm_law = holy_order_succession_law
		}
		scope:newchar = { add_character_flag = { flag = temp_law_hol_ord days = 3 } }
	}
	#делаем такое наследование чтобы передавались голда, маа и появлялось окно смерти
	if = {
		limit = {
			faith = {
				religious_head = root
				has_doctrine = doctrine_spiritual_head
				has_doctrine = doctrine_theocracy_temporal
			}
		}
		faith = {
			every_faith_ruler = {
				limit = {
					has_government = theocracy_government
				}
				faith = { add_to_variable_list = { name = theocrat_rulers target = prev } }
			}
		}
		faith = { save_scope_as = that_faith remove_doctrine = doctrine_theocracy_temporal add_doctrine = doctrine_theocracy_lay_clergy
		remove_doctrine = doctrine_spiritual_head add_doctrine = doctrine_no_head }
	}
	
	change_government = feudal_government
	add_realm_law_skip_effects = single_heir_succession_law
	set_designated_heir = scope:newchar

	#возвращаем правительство, наследник возвращает династию, убираем левого перса
	scope:newchar = {
		trigger_event = {
			id = agp_event.4
			days = 1
		}
	}
}

make_an_heir_selected_one_agp = {
	var:heir_agp = {
		save_scope_as = newchar
	}
	#если выбранный наследник бездомный, то создаем ему новый дом
	if = {
		limit = {
			scope:newchar = { is_lowborn = yes }
		}
		scope:newchar = {
			create_character = {
				employer = root
				age = 50
				gender = male
				random_traits = yes
				save_scope_as = faza
				dynasty = generate
			}
			scope:faza = { set_age = { value = scope:newchar.age add = 20 } }
			scope:faza = { death = natural }
			set_father = scope:faza
			set_house = scope:faza.house
		}
	}
	scope:newchar = { house = { save_scope_as = house_of_newchar } }

	#даем дом левому персу, чтобы дом не удалился из базы данных
	create_character = {
		employer = root
		age = { 62 98 }
		gender = male
		random_traits = yes
		save_scope_as = char
		dynasty = generate
	}
	scope:char = { set_house = scope:house_of_newchar }

	#меняем дом нашему наследнику, чтобы во вкладке происхождение отображалось все норм
	scope:newchar = {
		set_house = root.house
		add_prestige = 500
		add_piety = 300
	}

	#сохраняем наш тип правительства чтобы у наследника все было норм
	if = {
		limit = {
			has_government = republic_government
		}
		scope:newchar = { add_character_flag = { flag = temp_rep_gov days = 3 } }
	}
	else_if = {
		limit = {
			has_government = theocracy_government
		}
		scope:newchar = { add_character_flag = { flag = temp_theoc_gov days = 3 } }
	}
	else_if = {
		limit = {
			has_government = mercenary_government
		}
		scope:newchar = { add_character_flag = { flag = temp_merc_gov days = 3 } }
	}
	else_if = {
		limit = {
			has_government = holy_order_government
		}
		scope:newchar = { add_character_flag = { flag = temp_hol_ord_gov days = 3 } }
	}

	#сохраняем тип наследования чтобы у наследника все было норм
	if = {
		limit = {
			has_realm_law = city_succession_law
		}
		scope:newchar = { add_character_flag = { flag = temp_law_city days = 3 } }
		
	}
	else_if = {
		limit = {
			has_realm_law = bishop_theocratic_succession_law
		}
		scope:newchar = { add_character_flag = { flag = temp_law_bish days = 3 } }
	}
	else_if = {
		limit = {
			has_realm_law = mercenary_company_succession_law
		}
		scope:newchar = { add_character_flag = { flag = temp_law_merc days = 3 } }
	}
	else_if = {
		limit = {
			has_realm_law = holy_order_succession_law
		}
		scope:newchar = { add_character_flag = { flag = temp_law_hol_ord days = 3 } }
	}
	#делаем такое наследование чтобы передавались голда, маа и появлялось окно смерти
	if = {
		limit = {
			faith = {
				religious_head = root
				has_doctrine = doctrine_spiritual_head
				has_doctrine = doctrine_theocracy_temporal
			}
		}
		faith = {
			every_faith_ruler = {
				limit = {
					has_government = theocracy_government
				}
				faith = { add_to_variable_list = { name = theocrat_rulers target = prev } }
			}
		}
		faith = { save_scope_as = that_faith remove_doctrine = doctrine_theocracy_temporal add_doctrine = doctrine_theocracy_lay_clergy
		remove_doctrine = doctrine_spiritual_head add_doctrine = doctrine_no_head }
	}
	
	change_government = feudal_government
	add_realm_law_skip_effects = single_heir_succession_law
	set_designated_heir = scope:newchar

	#возвращаем правительство, наследник возвращает династию, убираем левого перса
	scope:newchar = {
		trigger_event = {
			id = agp_event.4
			days = 1
		}
	}
}