make_an_heir_agp = {
	create_character = {
		employer = root
		template = agp_heir_character
		save_scope_as = newchar
	}
	general_heir_agp_effects = yes
}

make_an_heir_selected_one_agp = {
	var:heir_agp = {
		save_scope_as = newchar
	}
	#if the selected heir is homeless, we create a new house for him
	if = {
		limit = {
			scope:newchar = { is_lowborn = yes }
		}
		scope:newchar = {
			create_character = {
				employer = root
				age = 50
				gender = male
				random_traits = yes
				save_scope_as = faza
				dynasty = generate
			}
			scope:faza = { set_age = { value = scope:newchar.age add = 20 } }
			scope:faza = { death = natural }
			set_father = scope:faza
			set_house = scope:faza.house
		}
	}
	general_heir_agp_effects = yes
}

make_an_heir_hof_agp = {
	primary_title.current_heir = {
		save_scope_as = newchar
	}
	#if the selected heir is homeless, we create a new house for him
	scope:newchar = {
		if = {
			limit = {
				is_lowborn = yes
			}
			create_character = {
				employer = root
				age = 50
				gender = male
				random_traits = yes
				save_scope_as = faza
				dynasty = generate
			}
			scope:faza = { set_age = { value = scope:newchar.age add = 20 } }
			scope:faza = { death = natural }
			set_father = scope:faza
			set_house = scope:faza.house
		}
		if = {
			limit = { is_landed = yes }
			every_held_title = {
				limit = { tier >= tier_county }
				add_to_list = heir_titles
				save_scope_value_as = {
					name = heir_titles_exist
					value = yes
				}
			}
			every_vassal = {
				add_to_list = heir_vassals
			}
			if = {
				limit = { exists = player_heir }
				player_heir = { save_scope_as = new_ruler_of_heir_titles }
			}
			else_if = {
				limit = {
					root = {
						any_child = {
							is_ruler = no
						}
						NOT = {
							any_child = {
								is_ruler = yes
							}
						}
					}
				}
				root = {
					random_child = {
						limit = { is_ruler = no }
						save_scope_as = new_ruler_of_heir_titles
					}
				}
			}
		}
	}
	general_heir_agp_effects = yes
}

general_heir_agp_effects = {
	scope:newchar = { house = { save_scope_as = house_of_newchar } }

	#give the house to the that person so that the house is not deleted from the database
	create_character = {
		employer = root
		age = { 62 98 }
		gender = male
		random_traits = yes
		save_scope_as = char
		dynasty = generate
	}
	scope:char = { set_house = scope:house_of_newchar }

	#change the house for our heir so that in the origins tab everything is shown normal
	scope:newchar = {
		set_house = root.house
		add_prestige = 500
		add_piety = 300
	}

	#Save our titles to list, because i couldnt make it work even with primogeniture
	every_held_title = {
		add_to_list = root_titles
	}

	#save our government type so that the successor will be ok
	if = {
		limit = {
			has_government = republic_government
		}
		scope:newchar = { add_character_flag = { flag = temp_rep_gov days = 3 } }
	}
	else_if = {
		limit = {
			has_government = theocracy_government
		}
		scope:newchar = { add_character_flag = { flag = temp_theoc_gov days = 3 } }
	}

	#save the inheritance type so that the successor will be ok
	if = {
		limit = {
			has_realm_law = city_succession_law
		}
		scope:newchar = { add_character_flag = { flag = temp_law_city days = 3 } }
		
	}
	else_if = {
		limit = {
			has_realm_law = bishop_theocratic_succession_law
		}
		scope:newchar = { add_character_flag = { flag = temp_law_bish days = 3 } }
	}

	#make inheritance this way so wen can pass gold, maa and a make appearance of the death window
	if = {
		limit = {
			faith = {
				religious_head = root
				has_doctrine = doctrine_spiritual_head
				has_doctrine = doctrine_theocracy_temporal
			}
		}
		faith = {
			every_faith_ruler = {
				limit = {
					has_government = theocracy_government
				}
				faith = { add_to_variable_list = { name = theocrat_rulers target = prev } }
			}
		}
		faith = { save_scope_as = that_faith remove_doctrine = doctrine_theocracy_temporal add_doctrine = doctrine_theocracy_lay_clergy
		remove_doctrine = doctrine_spiritual_head add_doctrine = doctrine_no_head }
	}
	
	change_government = feudal_government
	add_realm_law_skip_effects = single_heir_succession_law
	set_designated_heir = scope:newchar

	#return the government, the heir returns to the dynasty, remove the useless person
	scope:newchar = {
		trigger_event = {
			id = agp_event.4
			days = 1
		}
	}
}