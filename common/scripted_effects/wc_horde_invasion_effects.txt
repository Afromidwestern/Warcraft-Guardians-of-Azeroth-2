# Determine whether Blackhand exists or not
set_horde_characters_effect = {
	title:c_dark_portal.title_province = {
		save_scope_as = horde_entry_point
	}

	if = {
		limit = { 
			start_date = 583.1.1 
		}
		character:10000 = {
			save_scope_as = blackhand
		}
		scope:blackhand = {
			add_gold = 500
			add_dread = high_dread
			add_prestige = 750
			dynasty = {
				add_dynasty_prestige_level = 3
				add_dynasty_prestige = 3000
				add_dynasty_perk = warfare_legacy_1
				add_dynasty_perk = warfare_legacy_2
			}
			spawn_horde_troops_effect = yes
		}
	}
	else = {
		create_character = {
			name = "Blackhand"
			location = scope:horde_entry_point
			template = blackhand_character_template
			save_scope_as = blackhand
		}
		scope:blackhand = {
			give_nickname = nick_the_destroyer
			add_gold = 500
			add_dread = high_dread
			#spawn_horde_court_effect = yes
			#give_horde_land_effect = yes
			#form_the_horde_effect = yes
			add_prestige = 1000
			dynasty = {
				add_dynasty_prestige_level = 3
				add_dynasty_prestige = 3000
				add_dynasty_perk = warfare_legacy_1
				add_dynasty_perk = warfare_legacy_2
			}
			spawn_horde_troops_effect = yes
		}
	}

	every_player = {
		trigger_event = horde_invasion.0002 # Starts the Horde Invasion
	}
}

# Give Horde troops
spawn_horde_troops_effect = {
	spawn_army = {
		uses_supply = no
		inheritable = no
		name = horde_event_troops
		levies = {
			value = 5000
		}
		men_at_arms = {
			type = light_footmen
			stacks = 10
		}
		men_at_arms = {
			type = light_horsemen
			stacks = 5
		}
		men_at_arms = {
			type = armored_horsemen
			stacks = 5
		}
		men_at_arms = {
			type = mangonel
			stacks = 5
		}
		location = capital_province
	}
}

# Declare war on Stormwind
declare_war_on_stormwind_effect = {
	scope:blackhand = {
		start_war = {
			cb = horde_realm_invasion_war
			target = title:k_stormwind.holder
			target_title = title:k_stormwind.empire
		}
	}
}

# Horde war target evaluation and declaration
horde_war_target_evaluation_and_declaration_effect = {
	# Set the Horde Emperor as reference point
	save_scope_as = horde_warchief
	add_character_flag = {
		flag = free_horde_cb
		days = 14
	}
	# Select a new target
	random_neighboring_top_liege_realm_owner = {
		limit = {
			NOT = { is_allied_to = scope:horde_warchief }
			NOT = { this = scope:horde_warchief }
			NOT = { top_liege = scope:horde_warchief }
			save_temporary_scope_as = truce_check
			NOT = {
				scope:horde_warchief = {
					any_truce_target = {
						this = scope:truce_check
					}
				}
			}
		}
		weight = {
			base = 0
			modifier = {
				add = horde_invasion_target_character_weight
				always = yes
			}
		}
		save_temporary_scope_as = next_invasion_target
		primary_title = {
			save_temporary_scope_as = next_invasion_title_target
		}
	}
	start_war = {
		cb = horde_realm_invasion_war
		target = scope:next_invasion_target
		target_title = scope:next_invasion_title_target.empire
	}
}