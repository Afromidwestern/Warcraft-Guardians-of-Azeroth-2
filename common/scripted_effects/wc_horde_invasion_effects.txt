# Determine whether Blackhand exists or not
set_horde_characters_effect = {
	title:c_dark_portal.title_province = {
		save_scope_as = horde_entry_point
	}
	# If started in 583, give Blackhand resources and set major players
	story_owner = {
		save_scope_as = blackhand
	}
	character:10015 = {
		save_scope_as = guldan
	}
	character:10017 = {
		save_scope_as = teron
	}
	character:10019 = {
		save_scope_as = durotan
	}
	character:10050 = {
		save_scope_as = orgrim
	}
	character:52000 = {
		save_scope_as = chogall
	}
	scope:blackhand = {
		add_gold = 500
		add_dread = high_dread
		add_prestige = 750
		dynasty = {
			add_dynasty_prestige_level = 3
			add_dynasty_prestige = 3000
			add_dynasty_perk = warfare_legacy_1
			add_dynasty_perk = warfare_legacy_2
		}
		spawn_horde_troops_effect = yes
	}
}

# Give Horde troops
spawn_horde_troops_effect = {
	spawn_army = {
		uses_supply = no
		inheritable = no
		name = horde_event_troops
		levies = {
			value = 5000
		}
		men_at_arms = {
			type = light_footmen
			stacks = 10
		}
		men_at_arms = {
			type = light_horsemen
			stacks = 5
		}
		men_at_arms = {
			type = armored_horsemen
			stacks = 5
		}
		men_at_arms = {
			type = mangonel
			stacks = 5
		}
		location = capital_province
	}
}

# Declare war on Stormwind
declare_war_on_stormwind_effect = {
	debug_log = "The Horde has declared war on Stormwind!"
	debug_log_date = yes
	
	title:k_stormwind.holder = { save_scope_as = stormwind_holder }
	
	scope:blackhand = {
		add_character_flag = {
			flag = free_mongol_cb
			days = 14
		}
		start_war = {
			cb = mongol_invasion_war
			target = title:k_stormwind.holder
			target_title = title:k_stormwind.empire
		}
	}
	
	every_player = {
		trigger_event = horde_invasion.0002 # Notification
	}
}

# Horde war target evaluation and declaration
horde_war_target_evaluation_and_declaration_effect = {
	# Set the Horde Emperor as reference point
	save_scope_as = horde_warchief
	add_character_flag = {
		flag = free_mongol_cb
		days = 14
	}
	# Select a new target
	random_neighboring_top_liege_realm_owner = {
		limit = {
			NOT = { is_allied_to = scope:horde_warchief }
			NOT = { this = scope:horde_warchief }
			NOT = { top_liege = scope:horde_warchief }
			save_temporary_scope_as = truce_check
			NOT = {
				scope:horde_warchief = {
					any_truce_target = {
						this = scope:truce_check
					}
				}
			}
		}
		weight = {
			base = 0
			modifier = {
				add = horde_invasion_target_character_weight
				always = yes
			}
		}
		save_temporary_scope_as = next_invasion_target
		primary_title = {
			save_temporary_scope_as = next_invasion_title_target
		}
	}
	start_war = {
		cb = mongol_invasion_war
		target = scope:next_invasion_target
		target_title = scope:next_invasion_title_target.empire
	}
}