# Plague_barony { PLAGUER: character scope of person that will plague a place, PLACE: landed title scope of barony being plagued }
# Spawns army for PLAGUER based on levies of barony (if below 50 then at least 50).
# Also adds a "plague" modifier for the barony, if all baronies in a county are plagued then changes culture/faith of
# county.
plague_county = {
	save_temporary_scope_value_as = {
		name = army_to_raise
		value = {
			value = 1
			add = $PLACE$.development_level
			multiply = 50
			min = 50
		}
	}
	$PLACE$.title_province = { save_temporary_scope_as = plagued_province }
	
	$PLAGUER$ = {
		if = {
			limit = { exists = scope:plague_army }
			spawn_army = {
				levies = scope:army_to_raise
				location = scope:plagued_province
				inheritable = yes
				uses_supply = no
				name = plague_troops
				army = scope:plague_army
			}
		}
		else = {
			spawn_army = {
				levies = scope:army_to_raise
				location = scope:plagued_province
				inheritable = yes
				uses_supply = no
				name = plague_troops
				save_scope_as = plague_army
			}
		}
	}
	$PLACE$ = {
		set_county_culture = $PLAGUER$.culture
		set_county_faith = $PLAGUER$.faith
		
		change_development_level = -1
		add_county_modifier = {
			modifier = plagued_county_modifier
			years = 50
		}
	}
}

plague_consequences_known_or_exposed_effect = {
	$PLAGUER$ = {
		if = {
			limit = { this = $POV$ }
			dread_from_discovered_murder_effect = { VICTIM = $VICTIM$ }
		}
		else = {
			hidden_effect = {
				dread_from_discovered_murder_effect = { VICTIM = $VICTIM$ }
			}
		}
	}
	hostile_scheme_type_opinion_effect = {
		VICTIM = $VICTIM$
		ATTACKER = $PLAGUER$
		SCHEME_TYPE = plague
	}
}

# unknown_plague_effect { VICTIM: character scope of plagued player, PLAGUER: character scope of plaguing player, 
# PLACE: landed title scope of barony to be plagued}
# Effect when the plague happens and the plaguer is unknown for the other player. Calls plague_county and
# triggers spread_plague_county in 6 months, so basically because spread_plague_county spreads too, the plague is spreaded
# from 1 barony to another every 6 months.
unknown_plague_effect = {
	$VICTIM$ = {
	}

	$PLAGUER$ = {
		save_scope_as = plaguer
		#TODO - add secret if needed
	}

	$PLACE$ = {
		save_scope_as = plague_center
		
		trigger_event = {
			on_action = spread_plague_county
		}
	}
	
	$VICTIM$ = {
		# For now do nothing
	}
}

# known_plague_effect { VICTIM: character scope of plagued player, PLAGUER: character scope of plaguing player, 
# PLACE: landed title scope of barony to be plagued}
# Effect when the plague happens and the plaguer is known for the other player. Calls plague_county and
# triggers spread_plague_county in 6 months, so basically because spread_plague_county spreads too, the plague is spreaded
# from 1 barony to another every 6 months.
known_plague_effect = {
	$PLAGUER$ = {
		save_scope_as = plaguer
	}

	$PLACE$ = {
		save_scope_as = plague_center

		trigger_event = {
			on_action = spread_plague_county
		}
	}

	# show_as_tooltip = {
		plague_consequences_known_or_exposed_effect = {
			PLAGUER = $PLAGUER$
			VICTIM = $VICTIM$
			POV = root
		}
	# }
	
	$EXPOSER$ = {
		# For now do nothing
	}
}