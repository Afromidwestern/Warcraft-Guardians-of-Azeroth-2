plague_barony = {
	$PLAGUER$ = {
		if = {
			limit = {
				$PLACE$.title_province.building_levies > 50
			}
			spawn_army = {
				levies = $PLACE$.title_province.building_levies
				location = $PLAGUER$.capital_province 
				inheritable = yes
				uses_supply = yes
				name = plague_troops
			}
		}
		else = {
			spawn_army = {
				levies = 50
				location = $PLAGUER$.capital_province 
				inheritable = yes
				uses_supply = yes
				name = plague_troops
			}
		}
	}
	$PLACE$ = {
		change_development_level = 0
		title_province = {
			add_province_modifier = {
				modifier = plague_province_modifier
				years = 50
			}
		}

		county = {
			if = {
				limit = {
					NOT = {
						any_county_province = {
							NOT = { has_province_modifier = plague_province_modifier}
						}
					}
				}
				
				set_county_culture = $PLAGUER$.culture
				set_county_faith = $PLAGUER$.faith
				# change_county_control = -1
			}
		}
	}
}

purge_barony = {
	$PURGER$ = {

	}
	$PLACE$ = {
		every_connected_county = {
			limit = {
				any_county_province = {
					has_province_modifier = plague_province_modifier
				}
			}
			every_county_province = {
				if = {
					limit = {
						has_province_modifier = plague_province_modifier
					}
					remove_province_modifier = plague_province_modifier
					add_province_modifier = {
						modifier = weakened_plague_province_modifier
						months = 6
					}
					county = {
						set_county_culture = $PURGER$.culture
						set_county_faith = $PURGER$.faith
					}
				}
			}
		}

		title_province = {
			if = {
				limit = {
					has_province_modifier = plague_province_modifier
				}
				remove_province_modifier = plague_province_modifier
				add_province_modifier = {
					modifier = weakened_plague_province_modifier
					months = 6
				}
				county = {
					set_county_culture = $PURGER$.culture
					set_county_faith = $PURGER$.faith
				}
			}
		}

		# title_province = {
		# 	if = {
		# 		limit = {
		# 			has_province_modifier = plague_province_modifier
		# 		}
		# 		remove_province_modifier = plague_province_modifier
		# 	}
		# }			
	}
}

plague_consequences_known_or_exposed_effect = {
	$PLAGUER$ = {

	}
	$VICTIM$ = {

	}
	$POV$ = {

	}
}

unknown_plague_sacrifice_effect = {
	$SACRIFICE$ = {
		death = {
			killer = $PLAGUER$
			death_reason = death_duel
		}
	}
	$PLAGUER$ = {
		#TODO - add secrets and stuff if needed
	}
}

unknown_plague_effect = {
	$VICTIM$ = {
	}

	$PLAGUER$ = {
		save_scope_as = plaguer
		#TODO - add secret if needed
	}

	plague_barony = {
		PLACE = $PLACE$
		PLAGUER = $PLAGUER$
	}

	$PLACE$ = {
		save_scope_as = plagued_barony	
	}

	trigger_event = {
		on_action = spread_plague_barony
		months = 6
	}

	show_as_tooltip = {
		plague_consequences_known_or_exposed_effect = {
			PLAGUER = $PLAGUER$
			VICTIM = $VICTIM$
			POV = root
		}
	}
}

# Exposer can be another character, or the murderer themselves if no specific character makes sense
known_plague_sacrifice_effect = {
	$SACRIFICE$ = {
		death = {
			death_reason = death_plague_sacrifice
			killer = $PLAGUER$
		}
		hidden_effect = { set_killer_public = yes }
	}
 	$PLAGUER$ = {
		#TODO - add secret if needed
	}
	$EXPOSER$ = {

	}
	show_as_tooltip = {
		plague_consequences_known_or_exposed_effect = {
			PLAGUER = $PLAGUER$
			VICTIM = $SACRIFICE$
			POV = root
		}
	}
}

known_plague_effect = {
	hidden_effect = {

	}
	$VICTIM$ = {

	}
	$PLAGUER$ = {
		save_scope_as = plaguer
		#TODO - add secret if needed
	}

	plague_barony = {
		PLACE = $PLACE$
		PLAGUER = $PLAGUER$
	}

	$PLACE$ = {
		save_scope_as = plagued_barony

		trigger_event = {
			on_action = spread_plague_barony
			months = 6
		}
	}
	
	$EXPOSER$ = {
		
	}

	show_as_tooltip = {
		plague_consequences_known_or_exposed_effect = {
			PLAGUER = $PLAGUER$
			VICTIM = $VICTIM$
			POV = root
		}
	}
}

attempted_plague_opinion_effect = {
	$VICTIM$ = {
		if = {
			limit = { is_alive = yes }
			add_opinion = {
				target = $PLAGUER$
				modifier = attempted_plague_me_crime
			}
			hidden_effect = {
				add_opinion = {
					target = $PLAGUER$
					modifier = plague_personal_grudge_opinion
					years = 2
				}
			}
		}

		every_spouse = {
			limit = { NOT = { this = $PLAGUER$ } }
			add_to_temporary_list = close_family_plague_opinion_list
		}
		every_close_family_member = {
			limit = { NOT = { this = $PLAGUER$ } }
			add_to_temporary_list = close_family_plague_opinion_list
		}

		if = {
			limit = {
				any_in_list = {
					list = close_family_plague_opinion_list
					always = yes
				}
			}
			every_in_list = {
				list = close_family_plague_opinion_list
				custom = all_close_family_and_spouses

				add_opinion = {
					target = $PLAGUER$
					modifier = attempted_murder_close_family_crime
					years = 20
				}
			}
		}

	}
}