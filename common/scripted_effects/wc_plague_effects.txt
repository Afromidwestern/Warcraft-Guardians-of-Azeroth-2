# Plague_barony { PLAGUER: character scope of person that will plague a place, PLACE: landed title scope of barony being plagued }
# Spawns army for PLAGUER based on levies of barony (if below 50 then at least 50).
# Also adds a "plague" modifier for the barony, if all baronies in a county are plagued then changes culture/faith of
# county.
plague_barony = {
	$PLAGUER$ = {
		if = {
			limit = {
				$PLACE$.title_province.building_levies > 50
			}
			spawn_army = {
				levies = $PLACE$.title_province.building_levies
				location = $PLAGUER$.capital_province 
				inheritable = yes
				uses_supply = yes
				name = plague_troops
			}
		}
		else = {
			spawn_army = {
				levies = 50
				location = $PLAGUER$.capital_province 
				inheritable = yes
				uses_supply = yes
				name = plague_troops
			}
		}
	}
	$PLACE$ = {
		change_development_level = 0
		title_province = {
			add_province_modifier = {
				modifier = plague_province_modifier
				years = 50
			}
		}

		county = {
			if = {
				limit = {
					NOT = {
						any_county_province = {
							NOT = { has_province_modifier = plague_province_modifier}
						}
					}
				}
				
				set_county_culture = $PLAGUER$.culture
				set_county_faith = $PLAGUER$.faith
			}
		}
	}
}

plague_consequences_known_or_exposed_effect = {
	$PLAGUER$ = {
		if = {
			limit = { this = $POV$ }
			dread_from_discovered_murder_effect = { VICTIM = $VICTIM$ }
		}
		else = {
			hidden_effect = {
				dread_from_discovered_murder_effect = { VICTIM = $VICTIM$ }
			}
		}
	}
	hostile_scheme_type_opinion_effect = {
		VICTIM = $VICTIM$
		ATTACKER = $PLAGUER$
		SCHEME_TYPE = plague
	}
}

# unknown_plague_effect { VICTIM: character scope of plagued player, PLAGUER: character scope of plaguing player, 
# PLACE: landed title scope of barony to be plagued}
# Effect when the plague happens and the plaguer is unknown for the other player. Calls plague_barony and
# triggers spread_plague_barony in 6 months, so basically because spread_plague_barony spreads too, the plague is spreaded
# from 1 barony to another every 6 months.
unknown_plague_effect = {
	$VICTIM$ = {
	}

	$PLAGUER$ = {
		save_scope_as = plaguer
		#TODO - add secret if needed
	}

	plague_barony = {
		PLACE = $PLACE$
		PLAGUER = $PLAGUER$
	}

	$PLACE$ = {
		save_scope_as = plagued_barony	
	}

	trigger_event = {
		on_action = spread_plague_barony
		months = 6
	}

	show_as_tooltip = {
		plague_consequences_known_or_exposed_effect = {
			PLAGUER = $PLAGUER$
			VICTIM = $VICTIM$
			POV = root
		}
	}
}

# TODO - only if there's a concept of secret for the sacrifice on the event of a sacrifice ending
known_plague_sacrifice_effect = {
	$SACRIFICE$ = {
		death = {
			death_reason = death_plague_sacrifice
			killer = $PLAGUER$
		}
		hidden_effect = { set_killer_public = yes }
	}
 	$PLAGUER$ = {
		#TODO - add secret if needed
	}
	$EXPOSER$ = {

	}
	show_as_tooltip = {
		plague_consequences_known_or_exposed_effect = {
			PLAGUER = $PLAGUER$
			VICTIM = $SACRIFICE$
			POV = root
		}
	}
}

# known_plague_effect { VICTIM: character scope of plagued player, PLAGUER: character scope of plaguing player, 
# PLACE: landed title scope of barony to be plagued}
# Effect when the plague happens and the plaguer is known for the other player. Calls plague_barony and
# triggers spread_plague_barony in 6 months, so basically because spread_plague_barony spreads too, the plague is spreaded
# from 1 barony to another every 6 months.
known_plague_effect = {
	hidden_effect = {

	}
	$VICTIM$ = {

	}
	$PLAGUER$ = {
		save_scope_as = plaguer
		#TODO - add secret if needed
	}

	plague_barony = {
		PLACE = $PLACE$
		PLAGUER = $PLAGUER$
	}

	$PLACE$ = {
		save_scope_as = plagued_barony

		trigger_event = {
			on_action = spread_plague_barony
			months = 6
		}
	}
	
	$EXPOSER$ = {
		
	}

	show_as_tooltip = {
		plague_consequences_known_or_exposed_effect = {
			PLAGUER = $PLAGUER$
			VICTIM = $VICTIM$
			POV = root
		}
	}
}