wc_CASTER_start_channeling_SPELL_on_TARGET_effect = {
	$CASTER$ = {
		custom_description = { # Tooltip for spending mana
			text = wc_spell_monthly_mana_cost_effect
			value = wc_magic_spell_$SPELL$_cost_mana_monthly_value

			add_to_variable_list = {
				name = wc_$SPELL$_you_channel_on_variable_list
				target = $TARGET$
			}
		}
	}
	$TARGET$ = {
		while = {
			count = $CASTER$.wc_magic_spell_$SPELL$_effect_value

			add_character_modifier = { modifier = wc_magic_spell_$SPELL$_modifier }
		}
		add_to_variable_list = {
			name = wc_$SPELL$_channeled_on_me_variable_list
			target = $CASTER$
		}
	}
}

wc_stop_channeling_SPELL_on_me_effect = {
	if = {
		limit = { has_variable_list = wc_$SPELL$_channeled_on_me_variable_list }

		save_temporary_scope_as = wc_$SPELL$_target
		every_in_list = {
			variable = wc_$SPELL$_channeled_on_me_variable_list

			save_temporary_scope_as = wc_$SPELL$_casters
			remove_list_variable = {
				name = wc_$SPELL$_you_channel_on_variable_list
				target = scope:wc_$SPELL$_target
			}
		}
		remove_list_variable = {
			name = wc_$SPELL$_channeled_on_me_variable_list
			target = scope:wc_$SPELL$_casters
		}
		remove_all_character_modifier_instances = wc_magic_spell_$SPELL$_modifier
	}
}

wc_update_channeling_SPELL_effect = {
	hidden_effect = {
		if = {
			limit = { has_variable_list = wc_$SPELL$_you_channel_on_variable_list }

			save_temporary_scope_as = wc_spellcaster

			every_in_list = {
				variable = wc_$SPELL$_you_channel_on_variable_list

				wc_stop_channeling_SPELL_on_me_effect = { SPELL = $SPELL$ }
				save_temporary_scope_as = wc_spelltarget
				wc_CASTER_start_channeling_SPELL_on_TARGET_effect = {
					SPELL = $SPELL$
					CASTER = scope:wc_spellcaster
					TARGET = scope:wc_spelltarget
				}
			}
		}
	}
}