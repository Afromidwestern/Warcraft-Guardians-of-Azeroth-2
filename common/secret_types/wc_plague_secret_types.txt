# Don't work as normal secret, needed for exposure only
secret_plague_attempt = {
	category = plague

	is_valid = {
		secret_plague_is_valid_trigger = { OWNER = scope:secret_owner }
	}

	is_shunned = {
		secret_plague_is_shunned_trigger = { OWNER = scope:secret_owner }
	}

	is_criminal = {
		secret_plague_is_criminal_trigger = { OWNER = scope:secret_owner }
	}
	
	on_expose = {
		save_scope_as = secret
		scope:secret_target = {
			save_scope_as = victim
		}
		scope:secret_owner = {
			save_scope_as = plaguer
		}

		###EXPOSURE EVENTS###
		scope:plaguer = { trigger_event = plague_secrets.0115 } #Applies consequence effects

		scope:victim = {
			if = {
				limit = { is_alive = yes }
				if = {
					limit = { any_known_secret = { this = scope:secret } }
					add_character_flag = {
						flag = victim_knows
						days = 10
					}
				}
				trigger_event = plague_secrets.0116
			}
		}

		secret_exposed_notification_effect = yes
	}
}

# Don't work as normal secret, needed for exposure only
secret_plague = {
	category = plague
	is_valid = {
		secret_plague_is_valid_trigger = { OWNER = scope:secret_owner }
	}

	is_shunned = {
		secret_plague_is_shunned_trigger = { OWNER = scope:secret_owner }
	}

	is_criminal = {
		secret_plague_is_criminal_trigger = { OWNER = scope:secret_owner }
	}

	on_expose = {
		save_scope_as = secret
		scope:secret_target = {
			save_scope_as = victim
		}
		scope:secret_owner = {
			save_scope_as = plaguer
		}
		if = {
			limit = { exists = var:known_plague }
			save_scope_value_as = {
				name = known_plague
				value = yes
			}
		}

		###EXPOSURE EVENTS/EFFECTS###
		
		if = {
			limit = { NOT = { exists = scope:known_plague } }
			scope:plaguer = { trigger_event = plague_secrets.0117 } #Applies consequence effects
			#scope:victim = { set_killer_public = yes }
			debug_log = "NAMELESS KILLER"
			debug_log_scopes = yes
		}
		else = {
			scope:murderer = {
				secret_exposed_owner_effects_effect = { SECRET = scope:secret POV = scope:plaguer }
				secret_exposed_owner_opinion_effects_effect = yes
			}
		}

		secret_exposed_notification_effect = yes
	}
}