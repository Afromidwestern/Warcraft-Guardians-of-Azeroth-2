story_legion_invasion = {
	on_setup = {
		add_to_global_variable_list = {
			name = unavailable_unique_events
			target = flag:legion_spawn
		}
		
		if = {
			limit = {
				exists = title:e_scourge.holder
				title:e_scourge.holder = {
					any_owned_story = {
						exists = var:legions_puppet
					}
					save_scope_as = puppet_lich_king
				}
			}
			scope:puppet_lich_king = { #dreadlords take control
				trigger_event = WCLEI.3
			}
		}
	}

	on_end = {
		on_end_legion_effect = yes
	}

	on_owner_death = {
		if = {
			limit = {
				exists = story_owner.primary_heir
			}
			try_to_set_scourge_story_owner = { OWNER = story_owner.primary_heir }
		}
		else = {
			end_story = yes
		}
	}
	
	# The story should pick another target for AI Legion to invade
	effect_group = {
		days = { 30 60 }

		trigger = {
			story_owner = {
				is_ai = yes
				is_able_to_wage_war_trigger = yes
				has_title = title:e_burning_legion
			}
		}

		triggered_effect = {
			trigger = {
				always = yes
			}
			effect = {
				story_owner = { great_invader_target_evaluation_and_declaration_effect = { MULTIPLY = 1 } }
			}
		}
	}
	
	# Spread Corruption (like plague ?) for later
	# effect_group = {
	# 	years = 1
		
	# 	trigger = {
	# 		story_owner = {
	# 			is_ai = yes
	# 			has_title = title:e_burning_legion
	# 		}
	# 	}
	# }
	
	# Story handling in case of succession weirdness
	effect_group = {
		days = 180

		trigger = {
			story_owner = {
				NOT = { has_title = title:e_burning_legion }
			}
		}

		triggered_effect = {
			trigger = { exists = title:e_burning_legion.holder }
			effect = {
				try_to_set_legion_story_owner = { OWNER = title:e_burning_legion.holder }
			}
		}

		triggered_effect = {
			trigger = { NOT = { exists = title:e_burning_legion.holder } }
			effect = {
				end_story = yes
			}
		}
	}
	
	# Archi dead
	effect_group = {
		days = 25

		trigger = {
			NOT = { story_owner = scope:archimonde }
		}
		effect = {
			story_owner = {
				trigger_event = WCLEI.30
			}
		}
	}
}
