union_story_cycle = {
	on_setup = {
		#set_variable = { name = this_union value = flag:alliance }
		add_to_variable_list = {
			name = union_members
			target = story_owner
		}
	}

	on_end = {
	}

	on_owner_death = {
	}

	effect_group = {
		months = { 8 9 }
		
		### in case of some bugs, remove dead person from union member
		triggered_effect = {
			trigger = {
				has_variable_list = union_members
				any_in_list = {
					variable = union_members
					is_alive = no
				}
			}
			effect = {
				every_in_list = {
					variable = union_members
					limit = { is_alive = no }
					root = { remove_list_variable = { name = union_members target = prev } }
				}
			}
		}
		### State colors fixing if have game rule
		# if holder is not in union for some reason, or this title is not a primary title anymore, restore default color
		triggered_effect = {
			trigger = {
				has_game_rule = wc_unified_union_color_enabled
				has_variable_list = colored_titles
				any_in_list = {
					variable = colored_titles
					OR = {
						NAND = { holder = { has_variable = this_union var:this_union = root.var:this_union } }
						NOT = { this = holder.primary_title }
					}
				}
			}
			effect = {
				every_in_list = {
					variable = colored_titles
					limit = {
						OR = {
							NAND = { holder = { has_variable = this_union var:this_union = root.var:this_union } }
							NOT = { this = holder.primary_title }
						}
					}
					set_my_default_color_effect = yes
					root = { remove_list_variable = { name = colored_titles target = prev } }
				}
			}
		}
		# If union member changed his primary title, give the color to the new primary one
		triggered_effect = {
			trigger = {
				has_game_rule = wc_unified_union_color_enabled
				has_variable_list = union_members
				any_in_list = {
					variable = union_members
					primary_title = { NOT = { has_variable = my_default_color } }
				}
			}
			effect = {
				save_temporary_scope_as = union_scope
				every_in_list = {
					variable = union_members
					limit = { primary_title = { NOT = { has_variable = my_default_color } } }
					primary_title = { save_title_color_create_dummy_title_effect = { from_union = union_scope } }
					root = { add_to_variable_list = { name = colored_titles target = prev } }
				}
			}
		}
	}
}
