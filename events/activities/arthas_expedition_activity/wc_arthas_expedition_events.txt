namespace = wc_arthas_story

### Arthas gather a group to investigate the Plague. Uther (or trusted knight), Jaina (or trusted mage), Falric, Marwyn (or other trusted knights join)
wc_arthas_story.10 = {
	type = character_event
	title = wc_arthas_story_10_TITLE
	desc = {
		desc = wc_arthas_story_10_DESC_beggining
		triggered_desc = {
			trigger = {
				root = scope:activity_owner
			}
			desc = wc_arthas_story_10_DESC_arthas
		}
		desc = wc_arthas_story_10_DESC_ending
	}
	theme = death
	override_background = {
		reference = farmland
	}
	right_portrait = {
		character = scope:activity_owner
		animation = personality_bold
	}
	left_portrait = {
		character = scope:uther
		animation = worry
	}
	
	immediate = {
		if = {
			limit = { root = scope:activity_owner }

			find_uther_effect = yes
			scope:uther = {
				join_arthas_expedition_effect = yes
			}

			find_jaina_effect = yes
			scope:jaina = {
				join_arthas_expedition_effect = yes
			}
			scope:arthas.top_liege = { save_scope_as = terenas }

			every_knight = {
				limit = {
					is_ai = yes	#Players decide themselves
					
					can_be_invited_in_arthas_expedition_trigger = { INVITER = scope:activity_owner }
				}
				join_arthas_expedition_effect = yes
			}
		}
	}
	
	option = {
		trigger = { root = scope:activity_owner }
		name = wc_arthas_story_10_OPT_arthas
	}
	
	option = {
		trigger = {
			NOT = { root = scope:activity_owner }
			
			can_be_invited_in_arthas_expedition_trigger = { INVITER = scope:activity_owner }
		}
		name = wc_arthas_story_10_OPT_A
		
		scope:activity = {
			accept_invitation_for_character = root
		}
		
		add_prestige = major_prestige_gain
		
		stress_impact = {
			brave = massive_stress_impact_loss
			diligent = medium_stress_impact_loss
			lazy = medium_stress_impact_gain
			craven = massive_stress_impact_gain
		}
		
		ai_chance = {
			base = 25
			
			stress_impact_ai_chance_modifier = { TRAIT = brave STRESS = massive_stress_impact_loss }
			stress_impact_ai_chance_modifier = { TRAIT = diligent STRESS = medium_stress_impact_loss }
			stress_impact_ai_chance_modifier = { TRAIT = lazy STRESS = medium_stress_impact_gain }
			stress_impact_ai_chance_modifier = { TRAIT = craven STRESS = massive_stress_impact_gain }
		}
	}
	option = {
		trigger = {
			NOT = { root = scope:activity_owner }
		}
		name = wc_arthas_story_10_OPT_B
		
		scope:activity = {
			decline_invitation_for_character = root
		}
		
		stress_impact = {
			paranoid = minor_stress_impact_gain
			brave = medium_stress_impact_gain
		}
		
		ai_chance = {
			base = 100
			
			stress_impact_ai_chance_modifier = { TRAIT = paranoid STRESS = minor_stress_impact_gain }
			stress_impact_ai_chance_modifier = { TRAIT = brave STRESS = medium_stress_impact_gain }
		}
	}
}
# Everything around looks dead, you find an abandoned farm, is attacked by undead inside, briefly see Kel'Thuzad
wc_arthas_story.15 = {
	type = character_event
	title = wc_arthas_story_10_TITLE
	desc = wc_arthas_story_15_DESC
	theme = death
	override_background = {
		reference = wc_androhal_by_dlikt
	}
	right_portrait = {
		character = scope:activity_owner
		animation = disgust
	}
	left_portrait = {
		character = scope:kelthuzad
		animation = personality_dishonorable
	}
	
	immediate = {
		if = {
			limit = { root = scope:activity_owner }
			check_every_participant_in_arthas_expedition_effect = yes
			
			find_kelthuzad_effect = yes
			
			scope:activity = {
				every_participant = {
					limit = {
						NOT = { this = scope:activity_owner }
						is_in_arthas_expedition_trigger = yes
					}
					trigger_event = wc_arthas_story.15
				}
			}
		}
		arthas_solo_battle_roll_effect = { RISK = 3 }
	}
	
	option = {
		name = wc_arthas_story_15_OPT_A
	}
	
	after = {
		if = {
			limit = { root = scope:activity_owner }
			trigger_event = { id = wc_arthas_story.20 days = 7 }
		}
	}
}
# You meet Kel'Thuzad in Andorhal (or another plague center)
wc_arthas_story.20 = {
	type = character_event
	title = wc_arthas_story_10_TITLE
	desc = wc_arthas_story_20_DESC
	theme = death
	override_background = {
		reference = wc_cauldron_by_dlikt
	}
	right_portrait = {
		character = scope:activity_owner
		animation = rage
	}
	left_portrait = {
		character = scope:kelthuzad
		animation = personality_dishonorable
	}
	
	immediate = {
		if = {
			limit = { root = scope:activity_owner }
			check_every_participant_in_arthas_expedition_effect = yes
			
			find_kelthuzad_effect = yes
			find_stratholme_effect = yes
			find_malganis_effect = yes
			scope:activity.activity_province.county = { save_scope_as = andorhal }
			
			scope:activity = {
				every_participant = {
					limit = {
						NOT = { this = scope:activity_owner }
						is_in_arthas_expedition_trigger = yes
					}
					trigger_event = wc_arthas_story.20
				}
			}
		}
	}
	
	option = {
		name = wc_arthas_story_20_OPT_A
		
		arthas_solo_battle_roll_effect = { RISK = 5 }
		
		stress_impact = {
			vengeful = medium_stress_impact_loss
			wrathful = minor_stress_impact_loss
		}
		
		if = {
			limit = { root = scope:activity_owner }
			scope:kelthuzad = { override_death_killer_effect = { DEATH_REASON = death_battle KILLER = root } }
		}
	}
	
	after = {
		if = {
			limit = { root = scope:activity_owner }
			trigger_event = { id = wc_arthas_story.25 days = 7 }
		}
	}
}
# You chase Mal'Ganis, rest in Heartglen (or any other city), find out the Plague turns undead, instead of killing, is attacked by a huge undead army
wc_arthas_story.25 = {
	type = character_event
	title = wc_arthas_story_10_TITLE
	desc = wc_arthas_story_25_DESC
	theme = death
	override_background = {
		reference = farmland
	}
	right_portrait = {
		character = scope:activity_owner
		animation = shock
	}
	
	immediate = {
		if = {
			limit = { root = scope:activity_owner }
			check_every_participant_in_arthas_expedition_effect = yes
			
			scope:activity = {
				every_participant = {
					limit = {
						NOT = { this = scope:activity_owner }
						is_in_arthas_expedition_trigger = yes
					}
					trigger_event = wc_arthas_story.25
				}
			}
		}
	}
	
	option = {
		name = wc_arthas_story_25_OPT_A
		
		arthas_solo_battle_roll_effect = { RISK = 7 }
	}
	
	after = {
		if = {
			limit = { root = scope:activity_owner }
			trigger_event = { id = wc_arthas_story.30 days = 7 }
		}
	}
}
# You reach Stratholme (or any other big city), find out you're too late
wc_arthas_story.30 = {
	type = character_event
	title = wc_arthas_story_10_TITLE
	desc = wc_arthas_story_30_DESC
	theme = death
	override_background = {
		reference = wc_cauldron_by_dlikt
	}
	right_portrait = {
		character = scope:activity_owner
		animation = rage
	}
	left_portrait = {
		character = scope:malganis
		animation = personality_dishonorable
	}
	
	trigger = {
		can_find_stratholme_trigger = yes
	}
	on_trigger_fail = {
	
	}
	
	immediate = {
		if = {
			limit = { root = scope:activity_owner }
			check_every_participant_in_arthas_expedition_effect = yes
			
			find_malganis_effect = yes
			find_stratholme_effect = yes
			scope:activity.activity_province.county = { save_scope_as = plague_center }
			
			scope:activity = {
				every_participant = {
					limit = {
						NOT = { this = scope:activity_owner }
						is_in_arthas_expedition_trigger = yes
					}
					trigger_event = wc_arthas_story.30
				}
			}
		}
	}
	
	# Purge
	option = {
		trigger = { root = scope:activity_owner }
		name = wc_arthas_story_30_OPT_A
		
		show_as_tooltip = { purge_event_effect = yes }
		save_scope_value_as = { name = stratholme_action value = flag:purge }
		
		custom_tooltip = some_characters_may_abandom_you
		
		ai_chance = {
			base = 100
			
			stress_impact_ai_chance_modifier = { TRAIT = compassionate STRESS = massive_stress_impact_gain }
			stress_impact_ai_chance_modifier = { TRAIT = craven STRESS = medium_stress_impact_gain }
			stress_impact_ai_chance_modifier = { TRAIT = vengeful STRESS = medium_stress_impact_loss }
			stress_impact_ai_chance_modifier = { TRAIT = wrathful STRESS = minor_stress_impact_loss }
		}
	}
	# Evacuate
	option = {
		trigger = { root = scope:activity_owner }
		name = wc_arthas_story_30_OPT_B
		
		show_as_tooltip = { evacuate_event_effect = yes }
		save_scope_value_as = { name = stratholme_action value = flag:evacuate }
		
		ai_chance = {
			base = 50
			
			stress_impact_ai_chance_modifier = { TRAIT = compassionate STRESS = medium_stress_impact_loss }
			stress_impact_ai_chance_modifier = { TRAIT = craven STRESS = major_stress_impact_gain }
			stress_impact_ai_chance_modifier = { TRAIT = vengeful STRESS = medium_stress_impact_gain }
		}
	}
	# Quarantine
	option = {
		trigger = { root = scope:activity_owner }
		name = wc_arthas_story_30_OPT_C
		
		show_as_tooltip = { quarantine_event_effect = yes }
		save_scope_value_as = { name = stratholme_action value = flag:quarantine }
		
		ai_chance = {
			base = 25
			
			stress_impact_ai_chance_modifier = { TRAIT = compassionate STRESS = medium_stress_impact_gain }
			stress_impact_ai_chance_modifier = { TRAIT = brave STRESS = minor_stress_impact_gain }
			stress_impact_ai_chance_modifier = { TRAIT = vengeful STRESS = major_stress_impact_gain }
			stress_impact_ai_chance_modifier = { TRAIT = impatient STRESS = medium_stress_impact_gain }
		}
	}
	
	option = {
		trigger = { NOT = { root = scope:activity_owner } }
		name = wc_arthas_story_30_OPT_A_reaction
	}
	
	after = {
		if = {
			limit = { root = scope:activity_owner }
			scope:activity = {
				every_participant = {
					limit = {
						NOT = { this = scope:activity_owner }
						is_in_arthas_expedition_trigger = yes
					}
					trigger_event = { id = wc_arthas_story.35 days = 1 }
				}
			}
			trigger_event = { id = wc_arthas_story.40 days = 2 }
		}
	}
}
# Arthas tells you about his decision (it depends on Arthas' decision above)
wc_arthas_story.35 = {
	type = character_event
	title = {
		first_valid = {
			triggered_desc = {
				trigger = { scope:stratholme_action = flag:purge }
				desc = wc_arthas_story_35_TITLE_purge
			}
			triggered_desc = {
				trigger = { scope:stratholme_action = flag:evacuate }
				desc = wc_arthas_story_35_TITLE_evacuate
			}
			desc = wc_arthas_story_35_TITLE_quarantine
		}
	}
	desc = wc_arthas_story_35_DESC
	theme = death
	override_background = {
		reference = wc_cauldron_by_dlikt
	}
	right_portrait = {
		character = scope:activity_owner
		animation = worry
	}
	
	# Stay (purge)
	option = {
		trigger = { scope:stratholme_action = flag:purge }
		name = wc_arthas_story_35_OPT_A_purge
		
		show_as_tooltip = { purge_event_effect = yes }
		
		ai_chance = {
			base = 100
			
			stress_impact_ai_chance_modifier = { TRAIT = compassionate STRESS = massive_stress_impact_gain }
			stress_impact_ai_chance_modifier = { TRAIT = craven STRESS = medium_stress_impact_gain }
			stress_impact_ai_chance_modifier = { TRAIT = vengeful STRESS = medium_stress_impact_loss }
			stress_impact_ai_chance_modifier = { TRAIT = wrathful STRESS = minor_stress_impact_loss }
		}
	}
	# Stay (evacuate)
	option = {
		trigger = { scope:stratholme_action = flag:evacuate }
		name = wc_arthas_story_35_OPT_A_evacuate
		
		show_as_tooltip = { evacuate_event_effect = yes }
		
		ai_chance = {
			base = 50
			
			stress_impact_ai_chance_modifier = { TRAIT = compassionate STRESS = medium_stress_impact_loss }
			stress_impact_ai_chance_modifier = { TRAIT = craven STRESS = major_stress_impact_gain }
			stress_impact_ai_chance_modifier = { TRAIT = vengeful STRESS = medium_stress_impact_gain }
		}
	}
	# Stay (quarantine)
	option = {
		trigger = { scope:stratholme_action = flag:quarantine }
		name = wc_arthas_story_35_OPT_A_evacuate
		
		show_as_tooltip = { quarantine_event_effect = yes }
		
		ai_chance = {
			base = 25
			
			stress_impact_ai_chance_modifier = { TRAIT = compassionate STRESS = medium_stress_impact_gain }
			stress_impact_ai_chance_modifier = { TRAIT = brave STRESS = minor_stress_impact_gain }
			stress_impact_ai_chance_modifier = { TRAIT = vengeful STRESS = major_stress_impact_gain }
			stress_impact_ai_chance_modifier = { TRAIT = impatient STRESS = medium_stress_impact_gain }
		}
	}
	# Leave
	option = {
		name = {
			text = {
				first_valid = {
					triggered_desc = {
						trigger = { scope:stratholme_action = flag:purge }
						desc = wc_arthas_story_35_OPT_B_purge
					}
					desc = wc_arthas_story_35_OPT_B_evacuate
				}
			}
		}
		
		leave_arthas_expedition_effect = yes
		
		stress_impact = {
			brave = minor_stress_impact_gain
		}
		
		ai_chance = {
			base = 15
			
			stress_impact_ai_chance_modifier = { TRAIT = brave STRESS = minor_stress_impact_gain }
		}
	}
}
# Arthas does what he wanted with the city (it depends on Arthas' decision above)
wc_arthas_story.40 = {
	type = character_event
	title = {
		first_valid = {
			triggered_desc = {
				trigger = { scope:stratholme_action = flag:purge }
				desc = wc_arthas_story_35_TITLE_purge
			}
			triggered_desc = {
				trigger = { scope:stratholme_action = flag:evacuate }
				desc = wc_arthas_story_35_TITLE_evacuate
			}
			desc = wc_arthas_story_35_TITLE_quarantine
		}
	}
	desc = wc_arthas_story_40_DESC
	theme = death
	override_background = {
		reference = wc_cauldron_by_dlikt
	}
	right_portrait = {
		character = scope:activity_owner
		animation = worry
	}
	
	immediate = {
		if = {
			limit = { root = scope:activity_owner }
			check_every_participant_in_arthas_expedition_effect = yes
			
			scope:activity = {
				every_participant = {
					limit = {
						NOT = { this = scope:activity_owner }
						is_in_arthas_expedition_trigger = yes
					}
					add_to_temporary_list = stratholme_notified
				}
			}
			every_player = {
				limit = { get_news_from_region_trigger = { REGION = world_eastern_kingdoms } }
				add_to_temporary_list = stratholme_notified
			}
			every_in_list = {
				list = stratholme_notified
				trigger_event = wc_arthas_story.40
			}
		}
	}
	
	# Outcome
	option = {
		trigger = { is_in_arthas_expedition_trigger = yes }
		name = {
			text = {
				first_valid = {
					triggered_desc = {
						trigger = { scope:stratholme_action = flag:purge }
						desc = wc_arthas_story_40_OPT_A_purge
					}
					desc = wc_arthas_story_40_OPT_A_evacuate
				}
			}
		}
		
		if = {
			limit = { scope:stratholme_action = flag:purge }
			purge_event_effect = yes
		}
		else_if = {
			limit = { scope:stratholme_action = flag:evacuate }
			evacuate_event_effect = yes
		}
		else = {
			quarantine_event_effect = yes
		}
	}
	
	# Reaction
	option = {
		trigger = { is_in_arthas_expedition_trigger = no }
		name = {
			text = {
				first_valid = {
					triggered_desc = {
						trigger = {
							OR = {
								has_trait_or_trait_is_virtue_trigger = { TRAIT = compassionate }
								AND = {
									root.culture_group = scope:stratholme.culture_group
									root.religion = scope:stratholme.religion
								}
							}
						}
						desc = wc_arthas_story_40_OPT_B_negative
					}
					triggered_desc = {
						trigger = {
							OR = {
								has_trait_or_trait_is_virtue_trigger = { TRAIT = sadistic }
								has_trait_or_trait_is_virtue_trigger = { TRAIT = callous }
							}
						}
						desc = wc_arthas_story_40_OPT_B_positive
					}
					desc = wc_arthas_story_40_OPT_B_neutral
				}
			}
		}
	}
}