#Events for having secrets

namespace = wc_secrets

#I have been exposed as a someone who has Attempted plague
wc_secrets.0115 = {
	type = character_event
	title = wc_secrets.0001.t
	desc = {
		desc = wc_secrets.0115.start.desc
		first_valid = {
			triggered_desc = {
				trigger = { scope:victim = { is_alive = yes } }
				desc = wc_secrets.0115.victim_alive.desc
			}
			desc = wc_secrets.0115.victim_dead.desc
		}
	}
	theme = secret
	left_portrait = scope:secret_exposer
	right_portrait = scope:victim
	
	immediate = {
		secret_exposed_owner_effects_effect = { SECRET = scope:secret POV = root }
		secret_exposed_owner_opinion_effects_effect = yes
		play_music_cue = "mx_cue_murder"
	}

	option = {
		name = wc_secrets.0115.a
	}
}	

#Someone I care about has been exposed for Attempted plague/I care about the victim/I am the victim
scripted_trigger plague_secrets_0116_dislikes_plague_attempt = {
	OR = {
		ai_compassion >= 0
		AND = {
			is_close_family_of = scope:victim
			has_relation_friend = scope:victim
			is_spouse_of = scope:victim
			has_relation_lover = scope:victim
		}
		root = scope:victim
	}
	OR = {
		opinion = {
			target = scope:victim
			value > medium_negative_opinion
		}
		root = scope:victim
	}
	NOT = {
		religion = religion:deathbringer
		has_trait = sadistic
		opinion = {
			target = scope:victim
			value < medium_positive_opinion
		}
	}
}

wc_secrets.0116 = {
	type = character_event
	title = wc_secrets.0106.t
	desc = {
		first_valid = {
			#VICTIM DESC#
			triggered_desc = {
				trigger = { root = scope:victim }
				desc = {
					first_valid = {
						triggered_desc = {
							trigger = { has_character_flag = victim_knows }
							desc = wc_secrets.0106.victim_knows.desc
						}
						desc = wc_secrets.0106.victim.desc
					}
				}
			}
			#NON-VICTIM DESC
			desc = {
				first_valid = {
					triggered_desc = {
						trigger = { plague_secrets_0116_dislikes_plague_attempt = yes }
						desc = wc_secrets.0116.negative.desc
					}
					desc = wc_secrets.0116.positive.desc
				}
			}
		}
	}
	theme = secret
	override_background = {
		trigger = { allowed_to_imprison_character_trigger = { CHARACTER = scope:owner } } # Show throne room if you can order imprisonment
		event_background = throne_room
	}
	left_portrait = scope:secret_exposer
	right_portrait = scope:plaguer
	lower_right_portrait = scope:victim
	
	immediate = {
		secret_exposed_notification_effects_effect = { SECRET = scope:secret CHARACTER = scope:owner }
	}

	#Ok (for non-lieges)
	option = {
		trigger = {
			NAND = {
				allowed_to_imprison_character_trigger = { CHARACTER = scope:plaguer }
				OR = {
					has_opinion_modifier = {
						target = scope:plaguer
						modifier = attempted_murder_close_family_crime
					}
					has_opinion_modifier = {
						target = scope:plaguer
						modifier = attempted_murder_me_crime
					}
				}
			}
		}
		name = {
			trigger = {
				has_character_flag = victim_knows
			}
			text = wc_secrets.0116.victim_knows
		}
		name = {
			trigger = {
				NOT = { has_character_flag = victim_knows }
				plague_secrets_0116_dislikes_plague_attempt = yes
				opinion = {
					target = scope:plaguer
					value >= high_positive_opinion
				}
			}
			text = wc_secrets.0116.likes_negative
		}
		name = {
			trigger = {
				NOT = { has_character_flag = victim_knows }
				plague_secrets_0116_dislikes_plague_attempt = yes
				opinion = {
					target = scope:plaguer
					value < high_positive_opinion
				}
			}
			text = wc_secrets.0116.dislikes_negative
		}
		name = {
			trigger = {
				NOT = { has_character_flag = victim_knows }
				plague_secrets_0116_dislikes_plague_attempt = no
				opinion = {
					target = scope:plaguer
					value >= high_positive_opinion
				}
			}
			text = wc_secrets.0116.likes_positive
		}
		name = {
			trigger = {
				NOT = { has_character_flag = victim_knows }
				plague_secrets_0116_dislikes_plague_attempt = no
				opinion = {
					target = scope:plaguer
					value < high_positive_opinion
				}
			}
			text = wc_secrets.0106.dislikes_positive
		}	
	}

	#Imprison (for lieges)
	option = {
		trigger = {
			allowed_to_imprison_character_trigger = { CHARACTER = scope:plaguer }
			OR = {
				has_opinion_modifier = {
					target = scope:plaguer
					modifier = attempted_murder_close_family_crime
				}
				has_opinion_modifier = {
					target = scope:plaguer
					modifier = attempted_murder_me_crime
				}
			}
		}
		name = wc_secrets.0116.b

		imprison_character_effect = {
			TARGET = scope:plaguer
			IMPRISONER = root
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_zeal = low_chance_impact_positive_ai_value
			}
			modifier = {
				has_trait = zealous
				add = 100
			}
			modifier = {
				OR = {
					opinion = {
						target = scope:plaguer
						value < 0
					}
					opinion = {
						target = scope:victim
						value < 0
					}
				}
				add = 100
			}
			modifier = {
				OR = {
					is_close_family_of = scope:plaguer
					has_relation_friend = scope:plaguer
					is_close_family_of = scope:plaguer
					has_relation_friend = scope:plaguer
				}
				add = -100
			}
		}
	}

	#For liege: forgive
	option = {
		trigger = {
			allowed_to_imprison_character_trigger = { CHARACTER = scope:plaguer }
			OR = {
				has_opinion_modifier = {
					target = scope:plaguer
					modifier = attempted_murder_close_family_crime
				}
				has_opinion_modifier = {
					target = scope:plaguer
					modifier = attempted_murder_me_crime
				}
			}
		}
		name = wc_secrets.0116.c

		reverse_add_opinion = {
			target = scope:plaguer
			modifier = grateful_opinion
			opinion = 20
		}
		if = {
			limit = { scope:victim = { is_alive = yes } }
			reverse_add_opinion = {
				target = scope:victim
				modifier = angry_opinion
				opinion = -30
			}
		}


		ai_chance = {
			base = 10
			ai_value_modifier = {
				ai_compassion = low_chance_impact_positive_ai_value
			}
			modifier = {
				has_trait = cynical
				add = 100
			}
			modifier = {
				scope:plaguer = { is_ai = no }
				add = 50
			}
			modifier = {
				exists = scope:lover_reaction
				scope:lover_reaction = flag:all_is_good
				add = 100
			}
		}
	}
	

	after = {
		remove_character_flag = victim_knows
	}
}