namespace = companion_story_cycle

###########################################
# Name your companion
#	1001-0999
###########################################

#Name your companion
companion_story_cycle.1001 = {
	type = character_event
	title = companion_story_cycle.1001.t
	desc = companion_story_cycle.1001.desc
	theme = pet
	override_background = {
		trigger = {
			# Warcraft
			like_north_germanic_group_trigger = yes
			like_germanic_religion_trigger = yes
		}
		event_background = fp1_runestone
	}
	left_portrait = {
		character = root
		animation = personality_cynical
	}

	immediate = {
		assign_name_options_companion_story_cycle_effect = yes
		assign_name_options_companion_story_cycle_effect = yes
		assign_name_options_companion_story_cycle_effect = yes
		play_music_cue = "mx_cue_low_key_positive"

		if = {
			limit = { 
				is_ai = yes 
				has_character_modifier = wolf_companion
			}
			random_list = {
				1 = {
					trigger = { has_character_flag = name_amiable }
					set_variable = {
						name = story_cycle_animal_companion_name
						value = flag:dog_name_amiable
					}
				}
				1 = {
					trigger = { has_character_flag = name_nosewise }
					set_variable = {
						name = story_cycle_animal_companion_name
						value = flag:dog_name_nosewise
					}
				}
				1 = {
					trigger = { has_character_flag = name_holdfast }
					set_variable = {
						name = story_cycle_animal_companion_name
						value = flag:dog_name_holdfast
					}
				}
				1 = {
					trigger = { has_character_flag = name_gray }
					set_variable = {
						name = story_cycle_animal_companion_name
						value = flag:dog_name_gray
					}
				}
				1 = {
					trigger = { has_character_flag = name_choplicker }
					set_variable = {
						name = story_cycle_animal_companion_name
						value = flag:dog_name_choplicker
					}
				}
				1 = {
					trigger = { has_character_flag = name_shadow }
					set_variable = {
						name = story_cycle_animal_companion_name
						value = flag:dog_name_shadow
					}
				}
				1 = {
					trigger = { has_character_flag = name_snow }
					set_variable = {
						name = story_cycle_animal_companion_name
						value = flag:dog_name_snow
					}
				}
			}
		}
		else_if = {
			limit = { 
				is_ai = yes 
				has_character_modifier = bear_companion
			}
			random_list = {
				1 = {
					trigger = { has_character_flag = name_deathclaw }
					set_variable = {
						name = story_cycle_animal_companion_name
						value = flag:companion_name_deathclaw
					}
				}
				1 = {
					trigger = { has_character_flag = name_warfrost }
					set_variable = {
						name = story_cycle_animal_companion_name
						value = flag:companion_name_warfrost
					}
				}
				1 = {
					trigger = { has_character_flag = name_gnawbone }
					set_variable = {
						name = story_cycle_animal_companion_name
						value = flag:companion_name_gnawbone
					}
				}
				1 = {
					trigger = { has_character_flag = name_blackjack }
					set_variable = {
						name = story_cycle_animal_companion_name
						value = flag:companion_name_blackjack
					}
				}
				1 = {
					trigger = { has_character_flag = name_largepaw }
					set_variable = {
						name = story_cycle_animal_companion_name
						value = flag:companion_name_largepaw
					}
				}
			}
		}
		else_if = {
			limit = { 
				is_ai = yes 
				has_character_modifier = raven_companion
			}
			random_list = {
				1 = {
					trigger = { has_character_flag = name_bloodtalon }
					set_variable = {
						name = story_cycle_animal_companion_name
						value = flag:companion_name_bloodtalon
					}
				}
				1 = {
					trigger = { has_character_flag = name_shadow }
					set_variable = {
						name = story_cycle_animal_companion_name
						value = flag:companion_name_shadow
					}
				}
				1 = {
					trigger = { has_character_flag = name_amethyst }
					set_variable = {
						name = story_cycle_animal_companion_name
						value = flag:companion_name_amethyst
					}
				}
				1 = {
					trigger = { has_character_flag = name_snowflake }
					set_variable = {
						name = story_cycle_animal_companion_name
						value = flag:companion_name_snowflake
					}
				}
				1 = {
					trigger = { has_character_flag = name_feathers }
					set_variable = {
						name = story_cycle_animal_companion_name
						value = flag:companion_name_feathers
					}
				}
				1 = {
					trigger = { has_character_flag = name_beakbeak }
					set_variable = {
						name = story_cycle_animal_companion_name
						value = flag:companion_name_beakbeak
					}
				}
			}
		}
		else = {
			set_variable = {
				name = story_cycle_animal_companion_name
				value = flag:companion_name_default
			}
		}
	}

	widget = {
		gui = "event_window_widget_enter_text"
		container = "dynamic_birth_name"
		controller = {
			type = text
			data = {
				key = story_cycle_animal_companion_name
				#Wolf
				default = {
					localization_key = dog_name_amiable
					trigger = {
						has_character_flag = name_amiable
					}
				}
				default = {
					localization_key = dog_name_nosewise
					trigger = {
						has_character_flag = name_nosewise
					}
				}
				default = {
					localization_key = dog_name_holdfast
					trigger = {
						has_character_flag = name_holdfast
					}
				}
				default = {
					localization_key = dog_name_gray
					trigger = {
						has_character_flag = name_gray
					}
				}
				default = {
					localization_key = dog_name_shadow
					trigger = {
						has_character_flag = name_shadow
					}
				}
				default = {
					localization_key = dog_name_snow
					trigger = {
						has_character_flag = name_snow
					}
				}
				#Bear
				default = {
					localization_key = companion_name_deathclaw
					trigger = {
						has_character_flag = name_deathclaw
					}
				}
				default = {
					localization_key = companion_name_warfrost
					trigger = {
						has_character_flag = name_warfrost
					}
				}
				default = {
					localization_key = companion_name_gnawbone
					trigger = {
						has_character_flag = name_gnawbone
					}
				}
				default = {
					localization_key = companion_name_blackjack
					trigger = {
						has_character_flag = name_blackjack
					}
				}
				default = {
					localization_key = companion_name_largepaw
					trigger = {
						has_character_flag = name_largepaw
					}
				}
				#Raven
				default = {
					localization_key = companion_name_bloodtalon
					trigger = {
						has_character_flag = name_bloodtalon
					}
				}
				default = {
					localization_key = companion_name_shadow
					trigger = {
						has_character_flag = name_shadow
					}
				}
				default = {
					localization_key = companion_name_amethyst
					trigger = {
						has_character_flag = name_amethyst
					}
				}
				default = {
					localization_key = companion_name_snowflake
					trigger = {
						has_character_flag = name_snowflake
					}
				}
				default = {
					localization_key = companion_name_feathers
					trigger = {
						has_character_flag = name_feathers
					}
				}
				default = {
					localization_key = companion_name_beakbeak
					trigger = {
						has_character_flag = name_beakbeak
					}
				}

				default = {
					localization_key = companion_name_default
					trigger = {
						has_character_flag = name_default
					}
				}
			}
		}
		setup_scope = {
			root = { save_scope_as = text_target }
		}
	}

	option = {
		name = companion_story_cycle.1001.a
	}

	after = {
		remove_character_flag = is_naming_companion
		#Wolf
		remove_character_flag = name_amiable
		remove_character_flag = name_nosewise
		remove_character_flag = name_holdfast
		remove_character_flag = name_gray
		remove_character_flag = name_choplicker
		remove_character_flag = name_shadow
		remove_character_flag = name_snow

		#Bear
		remove_character_flag = name_deathclaw
		remove_character_flag = name_warfrost
		remove_character_flag = name_gnawbone
		remove_character_flag = name_blackjack
		remove_character_flag = name_largepaw

		#Raven
		remove_character_flag = name_bloodtalon
		remove_character_flag = name_shadow
		remove_character_flag = name_amethyst
		remove_character_flag = name_snowflake
		remove_character_flag = name_feathers
		remove_character_flag = name_beakbeak

		remove_character_flag = name_default

		if = {
			# We entered custom text into the pop up
			limit = { NOT = { has_variable = story_cycle_animal_companion_name } }
			set_variable = {
				name = story_cycle_animal_companion_name
				value = flag:custom
			}
		}
	}
}