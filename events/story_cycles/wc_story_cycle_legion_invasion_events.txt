namespace = WCLEI

#########################################
#
#	Legion Invasion events - CK3 Edition
#
#########################################

# Spawns the Legion, Archimonde and a bunch of things
WCLEI.1 = {
	type = empty
	hidden = yes

	trigger = {#for testing purpose# Can't happen twice
		NOT = { is_target_in_global_variable_list = { name = unavailable_unique_events target = flag:legion_spawn } }
		current_date > 592.1.1

	}

	immediate = {
		create_character = {
			save_scope_as =  archimonde
			location = title:c_dalaran.title_province
			template = tichondrius_character_template #temp
			
			name = "Archimonde"
		}
		scope:archimonde = {
			create_title_and_vassal_change = {
				type = created
				save_scope_as = created
				add_claim_on_loss = no
			}
			create_title_and_vassal_change = {
				type = conquest
				save_scope_as = conquest
				add_claim_on_loss = yes
			}
			title:e_burning_legion = {
				change_title_holder = {
					holder = scope:archimonde
					change = scope:created
				}
			}
			# title:d_sargeras_god = {
			# 	change_title_holder = {
			# 		holder = scope:archimonde
			# 		change = scope:created
			# 	}
			# }
			title:c_dalaran = {
				change_title_holder = {
					holder = scope:archimonde
					change = scope:conquest
					take_baronies = yes
				}
			}
			resolve_title_and_vassal_change = scope:conquest
			resolve_title_and_vassal_change = scope:created
			
			# Delayed army spawn
			trigger_event = WCLEI.2
			
			every_player = {
				limit = { get_news_from_region_trigger = { REGION = world_eastern_kingdoms_azeroth } }
				trigger_event = WCLEI.5
			}
			
			create_story = story_legion_invasion
		}
	}
}
# Delayed army spawn
WCLEI.2 = {
	type = character_event
	hidden = yes

	immediate = {
		legion_start_pack_effect = yes
	}
}
# Take full control of the undeads
# WCLEI.3 = {
# 	type = character_event
# 	hidden = yes

# 	immediate = {
# 		save_scope_as = nerzhul
		
		
# 	}
# }
# Notification: the Legion appears
WCLEI.5 = {
	type = character_event
	title = WCLEI_5_TITLE
	desc = WCLEI_5_DESC
	theme = war
	override_background = {
		reference = wc_background_twisting_nether
	}
	left_portrait = {
		character = scope:archimonde
		animation = personality_bold
	}

	option = {
		name = {
			text = {
				first_valid = {
					#
					triggered_desc = {
						trigger = { faith = faith:death_god }
						desc = WCLEI_5_OPT_A_death
					}
					#
					triggered_desc = {
						trigger = { faith = faith:orcish_fel }
						desc = WCLEI_5_OPT_A_legion
					}
					# 
					triggered_desc = { # Corrupted orcs option
						trigger = { faith = faith:orcish_fel }
						desc = WCLEI_5_OPT_A_evil
					}
					#
					desc = WCLEI_5_OPT_A_neutral
				}
			}
		}
	}
}


# Archimonde is dead, no leader, the Legion is dismantled on Azeroth
WCLEI.30 = {
	type = character_event
	title = WCLEI_15_TITLE
	desc = WCLEI_30_DESC
	theme = intrigue
	override_background = {
		reference = wc_background_twisting_nether
	}
	left_portrait = {
		character = root
		animation = fear
	}

	option = {
		name = LONG_LIVE_THE_KING_OPT #temp
		end_legion_effect = yes
	}
}