namespace = lordaeron 

##############################################
# 1001 - 1099: Reclamation of Lordaeron Events
##############################################

lordaeron.1001 = { 

	type = character_event
	title = lordaeron.1001.title
	desc = lordaeron.1001.desc
	theme = stewardship
	override_background = wc_undercity_throne_room

	immediate = { 
		title:b_lordaeron.title_province = { 
			remove_building = ruined_palace_01
			add_special_building = ruined_palace_02 
		}
		title:c_lordaeron ={
			set_county_culture = culture:forsaken
		}
	}

	right_portrait = { 
		character = root
		animation = steward
	}

	trigger = { 
		OR = { 
			is_of_forsaken_like_culture = yes 					#make sure i have the title...
			title:b_lordaeron.holder = { 						#or that I gave out the title to someome...
				self_or_liege_is_of_forsaken_like_culture = yes 
				any_liege_or_above = {this = root }
			}
		}
	}

	on_trigger_fail = { 
		trigger_event = lordaeron.1002
	}

	option = { 
		name = lordaeron.1001.opt.a

		show_as_tooltip = { 
			custom_tooltip = lordaeron.1001.tooltip.a
		}

		hidden_effect = { 
			global_var:sylvanas_character = { 
				trigger_event = { # replace with on-action for redirect?? or just use trigger_fail???
					id = lordaeron.1101 #selenite texts found in undercity; revival imminent
					years = 2
					delayed = yes
				}
			}
			while = { 
				count = 3 # in three different courts...
				random_vassal = { 
					limit = { 
						faith.religion = { is_in_family = rf_void }
						NOT = { government_has_flag = government_is_theocracy }
					}
					while = {
						count = 4 # four characters will adopt Forgotten Shadow as secret faith
						random_pool_character = { 
							province = this.capital_province
							limit = {
								NAND =  { 
									has_council_position = councillor_court_chaplain
									NOT = { faith = faith:forgotten_shadow }
									NOT = { government_has_flag = government_is_theocracy }
									NOT = { piety_level >= 2 }
									NOT = { exists = secret_faith }
									NAND = { has_trait = zealous has_trait = loyal has_trait = holy_warrior has_trait = cynical }
								}
							}
							secret_faith = faith:selenite_cult
						}
					}
				}
			} #total: 12 characters will adopt Forgotten Shadow secretly
			#TODO: Link the random vassals to the next event? could be cool to have secret faith characters randomly dispersed tho
		}
	}

}

# Failed construction of Undercity
lordaeron.1002 = { 

	type = character_event
	title = lordaeron.1002.title
	desc = lordaeron.1002.desc
	theme = dungeon
	override_background = wc_undercity_alley

	right_portrait = { 
		character = root
		animation = stress
	}

	immediate = { 
		debug_log = "SS - remove province modifier"
		title:b_lordaeron.title_province = {
			remove_province_modifier = wc_building_undercity
		}
		hidden_effect = { 
			trigger_event = {
				on_action = undercity_reset_construction
				years = 5
			}
		}
	}

	option = { 
		debug_log = "SS - lordaeron.1002.opt2"
		name = lordaeron.1002.opt.a
		show_as_tooltip = { 
			custom_tooltip = lordaeron.1002.tooltip.a
		}
	}
	
}

#####################################
#1100 - 1199: Post-Reclamation events
#####################################

#1100 - 1109: Selenite Revival

#lordaeron.1100 = { } Selenite Revival Redirect event in case Lordaeron changes hands

lordaeron.1101 = { 

	type = character_event
	title = lordaeron.1101.title
	desc = lordaeron.1101.desc
	theme = faith
	override_background = wc_undercity_throne_room

	immediate = {
		random_vassal = {
			limit = {
				AND = { 
					faith.religion = { is_in_family = rf_void }
					highest_held_title_tier >= tier_county
					NOT = { faith = faith:forgotten_shadow }
					NOT = { government_has_flag = government_is_theocracy }
					NOT = { piety_level >= 2 }
					NAND = { has_trait = zealous has_trait = loyal has_trait = holy_warrior has_trait = cynical }
				}
			}
			set_character_faith = faith:forgotten_shadow
			random_held_title = {
				set_county_faith = faith:forgotten_shadow
			}
			save_scope_as = selinite_1 
		}
		random_vassal = {
			limit = {
				AND = { 
					faith.religion = { is_in_family = rf_void }
					highest_held_title_tier >= tier_county
					NOT = { faith = faith:forgotten_shadow }
					NOT = { government_has_flag = government_is_theocracy }
					NOT = { piety_level >= 2 }
					NAND = { has_trait = zealous has_trait = loyal has_trait = holy_warrior has_trait = cynical }
				}
			}
			set_character_faith = faith:forgotten_shadow
			random_held_title = {
				set_county_faith = faith:forgotten_shadow
			}
			save_scope_as = selinite_2
		}
		random_vassal = {
			limit = {
				AND = { 
					faith.religion = { is_in_family = rf_void }
					highest_held_title_tier >= tier_county
					NOT = { faith = faith:forgotten_shadow }
					NOT = { government_has_flag = government_is_theocracy }
					NOT = { piety_level >= 2 }
					NAND = { has_trait = zealous has_trait = loyal has_trait = holy_warrior has_trait = cynical }
				}
			}
			set_character_faith = faith:forgotten_shadow
			random_held_title = {
				set_county_faith = faith:forgotten_shadow
			}
			save_scope_as = selinite_3
		}
	}

	right_portrait = { 
		character = root
		animation = worry
	}

	lower_left_portrait = {
		character = scope:selinite_1
	}

	lower_center_portrait = { 
		character = scope:selinite_2
	}

	lower_right_portrait = { 
		character = scope:selinite_3
	}

	trigger = { 
	self_or_top_leige_is_of_forsaken_like_culture = yes
	}

	on_trigger_fail = { 
		# handle this 
	}

	option = { 
		# retain sylvanas cult of personality - AI chance 75
		name = lordaeron.1101.opt.a
		title:c_lordaeron = { 
			set_county_faith = faith:forsaken_cult
		}
		add_character_modifier = { 
			modifier = wc_forsaken_subsumed_selinite_modifier
		}
		ai_chance = { 
			base = 75
			ai_value_modifier = {
				ai_honor = -0.5
				ai_compassion = -1
				ai_boldness = 1
				ai_rationality = 1
			}
		}
	}

	option = { 
		# convert and delegate religious authority to cult of forgotten shadow - AI chance 20
		name = lordaeron.1101.opt.b
		set_character_faith = faith:forgotten_shadow
		title:c_lordaeron = { 
			set_county_faith = faith:forgotten_shadow
		}
		every_vassal_or_below = { 
			limit = { 
				OR = {
					culture = culture:forsaken 
					faith = faith:forsaken_cult
				}
			}
			set_character_faith = faith:forgotten_shadow
		}
		add_character_modifier = { 
			modifier = wc_forsaken_embraced_selinite_modifier
		}
		ai_chance = { 
			base = 20
			ai_value_modifier = {
				ai_honor = -0.5
				ai_boldness = 1
				ai_zeal = -1
			}
		}
	}

	option = { 
		# retain cult of personality but grant religious freedom to selinites - AI chance 5
		name = lordaeron.1101.opt.c
		#vassal_contract_set_obligation_level = { type = religious_rights level = 1 } wanted to do this but necro govt blocks it
		random_list = { 
			55 = { 
				modifier = { add = 5 root = { has_trait = zealous} }
				modifier = { add = 5 root = { piety_level >= 3 } }
				modifier = { add = 5 root = { piety_level >= 4 } }
				modifier = { add = 5 root = { learning > decent_skill_rating }}
				modifier = { add = 5 root = { dread > 20 } }
				modifier = { add = 5 root = { dread > 40 } }
				modifier = { add = 5 root = { dread > 60 } }
				modifier = { add = -15 root = { dread > 80 } }
				# modifier for court chaplain piety level or intelligence?
				title:c_lordaeron = { 
					set_county_faith = faith:forsaken_cult
				}
			}
			45 = { 
				title:c_lordaeron = { 
					set_county_faith = faith:forgotten_shadow
				}
			}
		}
		add_character_modifier = { 
			modifier = wc_forsaken_tolerated_selinite_modifier
		}
		ai_chance = { 
			base = 5
			ai_value_modifier = {
				ai_honor = 0.5
				ai_compassion = 1
				ai_boldness = -1
				ai_zeal = -1
			}
		}
	}
}