namespace = theramore_events

#theramore_events.001 = {
#	type = character_event
#	hidden = yes
#	
#	immediate = {
#		
#	}
#}

##################################
########## Jaina Events ##########
##################################

theramore_events.001 = { #Hello Medivh
	type = character_event
	title = theramore_sm_events.001.t
	desc = theramore_sm_events.001.desc
	theme = travel_diplomacy
	override_background = {
		reference = sm_dalaran_background
	}
	left_portrait = {
		character = root
		animation = eyeroll
	}
	right_portrait = {
		character = character:5000
		animation = chaplain
	}

	option = {
		name = theramore_sm_events.001.a
		trigger_event = {
			id = theramore_events.002
			days = { 20 30 }
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = theramore_sm_events.001.b
		
		ai_chance = {
			base = 0
		}
	}
}
theramore_events.002 = { #We are in storm 1
	type = character_event
	title = theramore_sm_events.002.t
	desc = theramore_sm_events.002.desc
	theme = travel_sea
	override_background = {
		reference = sm_ship_in_storm_1
	}
	left_portrait = {
		character = root
		animation = stress
	}

	immediate = {
		trigger_event = {
			id = theramore_events.003
			days = { 15 30 }
		}
	}

	option = {
		name = theramore_sm_events.002.a
		set_variable = { name = my_destination_1 value = flag:northrend }

		ai_chance = {
			base = 1
		}
	}
	option = {
		name = theramore_sm_events.002.b
		set_variable = { name = my_destination_1 value = flag:kalimdor }

		ai_chance = {
			base = 8
		}
	}
	option = {
		name = theramore_sm_events.002.c
		set_variable = { name = my_destination_1 value = flag:pandaria }

		ai_chance = {
			base = 1
		}
	}
}
theramore_events.003 = { #We are in storm 2
	type = character_event
	title = theramore_sm_events.003.t
	desc = theramore_sm_events.003.desc
	theme = travel_sea
	override_background = {
		reference = sm_ship_in_storm_2
	}
	left_portrait = {
		character = root
		animation = worry
	}

	immediate = {
		trigger_event = {
			id = theramore_events.004
			days = { 15 30 }
		}
	}

	option = {#c_kamagua northrend east
		name = theramore_sm_events.003.a
		trigger = { var:my_destination_1 = flag:northrend }
		set_variable = { name = my_destination_2 value = flag:n_east }

		ai_chance = {
			base = 1
		}
	}
	option = {#c_riplash northrend west
		name = theramore_sm_events.003.b
		trigger = { var:my_destination_1 = flag:northrend }
		set_variable = { name = my_destination_2 value = flag:n_west }

		ai_chance = {
			base = 1
		}
	}
	option = {#c_feicu_dao pandaria east
		name = theramore_sm_events.003.a
		trigger = { var:my_destination_1 = flag:pandaria }
		set_variable = { name = my_destination_2 value = flag:p_east }

		ai_chance = {
			base = 1
		}
	}
	option = {#c_shanze_dao pandaria west
		name = theramore_sm_events.003.b
		trigger = { var:my_destination_1 = flag:pandaria }
		set_variable = { name = my_destination_2 value = flag:p_west }

		ai_chance = {
			base = 1
		}
	}
	option = {#c_dokahalor zandalar
		name = theramore_sm_events.003.c
		trigger = { var:my_destination_1 = flag:pandaria }
		set_variable = { name = my_destination_2 value = flag:p_zand }

		ai_chance = {
			base = 1
		}
	}
	option = {#c_bloodcurse kalimdor north
		name = theramore_sm_events.003.d
		trigger = { var:my_destination_1 = flag:kalimdor }
		set_variable = { name = my_destination_2 value = flag:k_north }

		ai_chance = {
			base = 1
		}
	}
	option = {#c_dulized kalimdor south
		name = theramore_sm_events.003.e
		trigger = { var:my_destination_1 = flag:kalimdor }
		set_variable = { name = my_destination_2 value = flag:k_south }

		ai_chance = {
			base = 1
		}
	}
	option = {#c_bladescar durotar
		name = theramore_sm_events.003.f
		trigger = { var:my_destination_1 = flag:kalimdor }
		set_variable = { name = my_destination_2 value = flag:k_durotar }

		ai_chance = {
			base = 1
		}
	}
	option = {#c_theramore
		name = theramore_sm_events.003.g
		trigger = { var:my_destination_1 = flag:kalimdor }
		set_variable = { name = my_destination_2 value = flag:k_theramore }

		ai_chance = {
			base = 1
		}
	}
}
theramore_events.004 = { #We settle - we attack
	type = character_event
	title = theramore_sm_events.004.t
	desc = theramore_sm_events.004.desc
	theme = realm
	override_background = {
		reference = new_home_theramore
	}
	left_portrait = {
		character = root
		animation = aggressive_spear
	}

	immediate = {
		switch = {
			trigger = var:my_destination_2
			flag:n_east = { title:c_kamagua = { save_scope_as = new_theramore_capital } }#c_kamagua northrend east
			flag:n_west = { title:c_riplash = { save_scope_as = new_theramore_capital } }#c_riplash northrend west
			flag:p_east = { title:c_feicu_dao = { save_scope_as = new_theramore_capital } }#c_feicu_dao pandaria east
			flag:p_west = { title:c_shanze_dao = { save_scope_as = new_theramore_capital } }#c_shanze_dao pandaria west
			flag:p_zand = { title:c_dokahalor = { save_scope_as = new_theramore_capital } }#c_dokahalor zandalar
			flag:k_north = { title:c_bloodcurse = { save_scope_as = new_theramore_capital } }#c_bloodcurse kalimdor north
			flag:k_south = { title:c_dulized = { save_scope_as = new_theramore_capital } }#c_dulized kalimdor south
			flag:k_durotar = { title:c_bladescar = { save_scope_as = new_theramore_capital } }#c_bladescar durotar
			flag:k_theramore = { title:c_theramore = { save_scope_as = new_theramore_capital } }#c_theramore
		}
		remove_variable = my_destination_1
		remove_variable = my_destination_2
		give_land_to_settler = { TO_WHO = root COUNTY_NAME = scope:new_theramore_capital GIVE_INDEPENDENCY = yes ADD_CLAIM_ON_LOSS = yes }
		if = { #ai cant handle to win with only one county
			limit = { is_ai = yes }
			scope:new_theramore_capital = {
				if = {
					limit = { this = title:c_riplash }
					title:c_randlish = {
						give_land_to_settler = { TO_WHO = root COUNTY_NAME = this GIVE_INDEPENDENCY = yes ADD_CLAIM_ON_LOSS = yes }
					}
				}
				else = {
					random_neighboring_county = {
						give_land_to_settler = { TO_WHO = root COUNTY_NAME = this GIVE_INDEPENDENCY = yes ADD_CLAIM_ON_LOSS = yes }
					}
				}
			}
		}
		hidden_effect = {
			give_land_to_settler = { TO_WHO = title:k_dalaran.holder COUNTY_NAME = title:c_dalarans_hills GIVE_INDEPENDENCY = no ADD_CLAIM_ON_LOSS = no }
		}
		scope:new_theramore_capital = {
			hidden_effect = { change_development_level = 4 change_county_control = 40 }
			title_province = {
				if = {
					limit = {
						has_holding_type = tribal_holding
					}
					set_holding_type = castle_holding
					hidden_effect = { generate_building = yes }
				}
				hidden_effect = { generate_building = yes }
			}
		}
	}

	option = {
		name = theramore_sm_events.004.a
		add_prestige = 1000
		add_gold = 700
		
		scope:new_theramore_capital.duchy = {
			every_de_jure_county_holder = {
				limit = { NOT = { this = root } }
				top_liege = { add_to_list = potential_war_targets }
			}
		}
		every_in_list = {
			list = potential_war_targets
			root = {
				start_war = {
					cb = migration_theramore_war
					target = prev.top_liege
					target_title = scope:new_theramore_capital.duchy
				}
			}
		}
		if = {
			limit = { is_at_war_as_attacker = yes }
			random_character_war = {
				save_temporary_scope_as = this_war
			}
			spawn_army = {
				uses_supply = no
				inheritable = yes
				name = remnants_of_alliance_troops
				levies = {
					value = 2400
				}
				location = capital_province
				origin = capital_province
				war = scope:this_war
			}
		}
		else = {
			show_as_tooltip = { #war scope doesnt exist before clicking option, so it will be empty other way
				spawn_army = {
					uses_supply = no
					inheritable = yes
					name = remnants_of_alliance_troops
					levies = {
						value = 2400
					}
					location = capital_province
					origin = capital_province
				}
			}
		}
		spawn_army = {
			uses_supply = no
			inheritable = yes
			name = remnants_of_alliance_troops
			levies = {
				value = 1355
			}
			men_at_arms = {
				type = armored_footmen
				stacks = 5
			}
			men_at_arms = {
				type = light_horsemen
				stacks = 2
			}
			men_at_arms = {
				type = aerial_unit
				stacks = 4
			}
			men_at_arms = {
				type = armored_horsemen
				stacks = 2
			}
			men_at_arms = {
				type = caster_unit
				stacks = 3
			}
			men_at_arms = {
				type = trebuchet
				stacks = 2
			}
			location = capital_province
			origin = capital_province
		}
	}
}
theramore_events.005 = { #Ve von
	type = character_event
	title = theramore_sm_events.005.t
	desc = theramore_sm_events.005.desc
	theme = realm
	override_background = {
		reference = new_home_theramore
	}
	left_portrait = {
		character = root
		animation = happiness
	}

	immediate = {
		set_culture = culture:theramore
		save_scope_as = theramore_ruler
		hidden_effect = {
			every_courtier_or_guest = {
				set_culture = culture:theramore
			}
			every_sub_realm_county = {
				limit = { holder = root NOT = { culture = culture:theramore } }
				set_county_faith = root.faith
				set_county_culture = culture:theramore
				change_development_level = 4 change_county_control = 40
				title_province = {
					if = {
						limit = {
							has_holding_type = tribal_holding
						}
						set_holding_type = castle_holding
					}
					generate_building = yes
				}
			}
		}
		if = {
			limit = { NOT = { has_global_variable = founded_theramore } }
			every_player = {
				limit = { NOT = { this = root } }
				trigger_event = {
					id = theramore_events.006
					days = 1
				}
			}
			set_global_variable = founded_theramore
		}
	}
	option = {
		name = theramore_sm_events.005.a
		add_prestige_level = 2
		custom_tooltip = {
			text = theramore_sm_events_005_tooltip
			scope:new_theramore_duchy = {
				set_coa = d_theramore
				set_title_name = d_theramore
				title_capital_county = {
					set_title_name = d_theramore
					set_coa = d_theramore
					title_province.barony = {
						set_title_name = d_theramore
					}
				}
			}
		}
	}
}

theramore_events.006 = { #Notification to other players
	type = character_event
	title = theramore_sm_events.006.t
	desc = theramore_sm_events.006.desc
	theme = travel_sea
	override_background = {
		reference = sm_ship_in_storm_1
	}
	left_portrait = {
		character = scope:theramore_ruler
		animation = war_attacker
	}

	option = {
		name = theramore_sm_events.006.a
	}
}