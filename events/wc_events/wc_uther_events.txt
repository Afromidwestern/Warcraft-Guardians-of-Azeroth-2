namespace = uther_events

# Death of Terenas
uther_events.001 = {
	title = uther_events.001.t
	desc = uther_events.001.d
	theme = dread
	override_background = {
		reference = throne_room
	}
	right_portrait = {
		character = scope:uther  
		animation = sadness
	}

	left_portrait = {
		character = scope:arthas
		animation = personality_cynical
	}

	immediate = {
		stress_impact = {
			base = minor_stress_impact_gain
		}
	}

	# Retire the hammer
	option = {
		name = uther_events.001.a
		add_trait = depressed_1
		add_prestige = -500
		add_prowess_skill = -5
		add_character_modifier = {
			modifier = retired_modifier
		}
	}

	# Anger at arthas
	option = {
		name = uther_events.001.b

		set_relation_rival = {
			reason = rival_heresy
			target = scope:arthas
		}

		add_trait = depressed_1

		hidden_effect = {
			stress_impact = {
				base = 100
			}
		}
	}

	# Protect lordaeron 
	option = {
		name = uther_events.001.c
		trigger = { 
			NOT = { has_trait = being_undead }
		}
		if = {
			limit = { NOT = { faith = faith:scarlet } }
			set_character_faith = faith:scarlet
		}

		add_trait = zealous
		add_prowess_skill = 5

		hidden_effect = {
			stress_impact = {
				base = 150
			}
		}
	}
}

# The Culling
uther_events.002 = {
	title = uther_events.002.t
	desc = uther_events.002.d
	theme = plague
	override_background = {
		reference = wc_stratholme
	}

	left_portrait = {
		character = root
		animation = disbelief
	}
	right_portrait = {
		character = scope:host
		animation = personality_bold
	}

	#just in case 
	trigger = {
		is_uther_trigger = yes
	}

	immediate = {
		stress_impact = {
			base = medium_stress_impact_gain
		}
		involved_activity = {
			save_scope_as = activity
		}
	}

	# Leave
	option = {
		name = uther_events.002.a
		# Continue as normal
		scope:activity = { trigger_event = { id = wc_arthas_story.40 days = 3 } }
		leave_arthas_expedition_event_effect = yes		 
	}

	# Try and convince Arthas otherwise
	option = {
		name = uther_events.002.b
		duel = {
			target = scope:host
			skills = { prowess intrigue }
			value = decent_skill_rating
			50 = {
				modifier = { #rng
					add = { -10 10 }
					is_alive = yes
				}
				# AI more likely to lose to keep to original story
				modifier = {
					add = { -15 0 }
					is_ai = yes
				}
				modifier = {
					add = { 5 10 }
					is_ai = no
				}
				compare_modifier = {
					value = scope:duel_value
					multiplier = 3.5
					min = -49
				}
				custom_tooltip = uther_win_tooltip
				trigger_event = {
					id = uther_events.003
				}
			}
			50 = { #You lose
				compare_modifier = {
					value = scope:duel_value
					multiplier = -3.5
					min = -49
				}
				custom_tooltip = uther_lose_tooltip
				trigger_event = {
					id = uther_events.004
				}
			}
		}
	}
}

# Convince - Win 
uther_events.003 = {
	title = uther_events.003.t
	desc = uther_events.003.d
	theme = plague

	override_background = {
		reference = wc_stratholme
	}

	left_portrait = {
		character = root
		animation = thinking
	}
	right_portrait = {
		character = scope:host
		animation = personality_rational
	}

	#just in case 
	trigger = {
		is_uther_trigger = yes
	}

	# Quarantine Instead
	option = {
		name = uther_events.003.a
		save_scope_value_as = { name = stratholme_action value = flag:quarantine }
	}

	# Evacuate instead
	option = {
		name = uther_events.003.b
		save_scope_value_as = { name = stratholme_action value = flag:evacuate }
	}

	# Arthas choice
	option = {
		name = uther_events.003.c
		hidden_effect = {
			random_list = {
				40 = { # he decides to quarantine
					save_scope_value_as = { name = stratholme_action value = flag:quarantine }
					send_interface_toast = {
						title = arthas_decides_q
						desc = arthas_decides_q_desc
						left_icon = scope:arthas
						right_icon = root
					}
				}
				40 = { # evac
					save_scope_value_as = { name = stratholme_action value = flag:evacuate }
					send_interface_toast = {
						title = arthas_decides_e
						desc = arthas_decides_e_desc
						left_icon = scope:arthas
						right_icon = root
					}
				}
				20 = { #betray
					add_character_flag = arthas_betrayal
					save_scope_value_as = { name = stratholme_action value = flag:purge }
				}
			}
		}
	}

	after = {
		if = {
			limit = { NOT = { var:stratholme_action = flag:purge } } 
			#notify group of change
			share_event_with_group_delay_effect = {
				ID = uther_events.035
				DAYS = 1
			}
		}
	}
}

#Notif for group
uther_events.035 = {
	title = uther_events.003.t
	desc = {
		desc = uther_events.035.d
		triggered_desc = {
			trigger = { var:stratholme_action = flag:quarantine }
			desc = uther_events.035.d_q
		}
		triggered_desc = {
			trigger = { var:stratholme_action = flag:evacuate }
			desc = uther_events.035.d_e
		}
	}

	theme = plague

	trigger = {
		NOT = { is_uther_trigger = yes }
	}

	left_portrait = {
		character = root
		animation = happiness
	}

	right_portrait = {
		character = scope:arthas
		animation = personality_bold
	}

	lower_center_portrait = {
		character = scope:activity.var:uther  
		animation = idle
	}

	override_background = {
		reference = wc_stratholme
	}

	option = {
		name = uther_events.035.a
	}

	option = { # why would he consider doing that
		name = uther_events.035.b
		add_opinion = {
			target = scope:arthas
			modifier = disappointed_opinion
		}
	}

	after = {
		remove_character_flag  = uther_decision
		# Continue as normal
		scope:activity = { trigger_event = { id = wc_arthas_story.40 days = 3 } }	
	}
}

# Convince - Fail
uther_events.004 = {
	title = uther_events.003.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = { has_character_flag = arthas_betrayal }
				desc = uther_events.004.d_betrayal
			}
		}
		desc = uther_events.004.d
	}
	theme = plague

	override_background = {
		reference = wc_stratholme
	}

	left_portrait = {
		character = root
		animation = sadness
	}
	right_portrait = {
		character = scope:host
		animation = anger
	}

	#just in case 
	trigger = {
		is_uther_trigger = yes
	}

	immediate = {
		#kick arthas out of silver hand
	}

	# Oh well...
	option = {
		name = uther_events.004.a
		
		random_list = {
			40 = {
				progress_towards_rival_effect = {
					CHARACTER = scope:host
					REASON = rival_purge_stratholme
					OPINION = -15
				}
				stress_impact = {
					base = massive_stress_impact_gain
				}
			}
			40 = {
				progress_towards_rival_effect = {
					CHARACTER = scope:host
					REASON = rival_purge_stratholme
					OPINION = -30
				}
				stress_impact = {
					base = major_stress_impact_gain
				}
			}
			20 = {
				add_trait = depressed_1
				stress_impact = {
					base = medium_stress_impact_gain
				}
			}
		}
		leave_arthas_expedition_event_effect = yes
	}

	# He must pay... 
	option = {
		name = uther_events.004.b

		add_trait = vengeful
		set_character_faith = faith:scarlet

		progress_towards_rival_effect = {
			CHARACTER = scope:host
			REASON = rival_purge_stratholme
			OPINION = -40
		}
		leave_arthas_expedition_event_effect = yes
	}

	# decide to stay?

	option = {
		name = uther_events.004.c
		custom_tooltip = uther_stay_tooltip
	}


	after = {
		if = { 
			limit = { has_character_flag = arthas_betrayal }
			remove_character_flag = arthas_betrayal
		}
		remove_character_flag = uther_decision		
		# Continue as normal
		scope:activity = { trigger_event = { id = wc_arthas_story.40 days = 3 } }
	}
}